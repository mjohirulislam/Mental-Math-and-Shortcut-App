<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GRE Quant 170 â€” Master Mode</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¯</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Outfit:wght@300;400;600;700;900&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root,[data-theme="dark"]{
--bg:#06060b;--surface:#0e0e17;--surface2:#161622;--surface3:#1d1d2d;
--border:#272740;--border2:#33334d;
--accent:#00e5a0;--accentD:rgba(0,229,160,.1);
--ac2:#7c5cfc;--ac2D:rgba(124,92,252,.1);
--ac3:#ff6b6b;--ac3D:rgba(255,107,107,.1);
--ac4:#ffd93d;--ac4D:rgba(255,217,61,.1);
--ac5:#00b4ff;--ac5D:rgba(0,180,255,.1);
--text:#eaeaf2;--text2:#7a7a94;--text3:#50506a;
--correct:#00e5a0;--wrong:#ff6b6b;
--shadow:0 4px 24px rgba(0,0,0,.4);
--glow:0 0 20px rgba(0,229,160,.08);
}
[data-theme="light"]{
--bg:#f3f3f8;--surface:#fff;--surface2:#ededf4;--surface3:#e2e2ec;
--border:#ccccd8;--border2:#b8b8c8;
--accent:#00a070;--accentD:rgba(0,160,112,.08);
--ac2:#5838d0;--ac2D:rgba(88,56,208,.08);
--ac3:#d83030;--ac3D:rgba(216,48,48,.08);
--ac4:#b89800;--ac4D:rgba(184,152,0,.08);
--ac5:#0078b8;--ac5D:rgba(0,120,184,.08);
--text:#16162a;--text2:#5a5a72;--text3:#8888a0;
--correct:#00a070;--wrong:#d83030;
--shadow:0 4px 24px rgba(0,0,0,.06);
--glow:none;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background .3s,color .3s}
.mono{font-family:'JetBrains Mono',monospace}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,160,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,160,.015) 1px,transparent 1px);background-size:48px 48px;pointer-events:none;z-index:0}
[data-theme="light"] body::before{background-image:linear-gradient(rgba(0,0,0,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,0,0,.025) 1px,transparent 1px)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
a{color:var(--accent);text-decoration:none}

/* â”€â”€ NAV â”€â”€ */
nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(6,6,11,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);height:54px;display:flex;align-items:center;padding:0 16px;gap:12px;transition:background .3s}
[data-theme="light"] nav{background:rgba(243,243,248,.92)}
.logo{font-family:'Outfit';font-weight:900;font-size:1.1rem;letter-spacing:-.4px;display:flex;align-items:center;gap:7px;flex-shrink:0;cursor:pointer}
.logo-icon{width:28px;height:28px;background:linear-gradient(135deg,var(--accent),var(--ac2));border-radius:7px;display:grid;place-items:center;font-size:13px;font-weight:900;color:#fff}
.nav-tabs{display:flex;gap:1px;background:var(--surface2);padding:2px;border-radius:9px;margin:0 auto}
.nav-tab{background:none;border:none;color:var(--text2);font-family:'DM Sans';font-size:.77rem;font-weight:600;padding:5px 13px;border-radius:7px;cursor:pointer;transition:all .15s;white-space:nowrap}
.nav-tab:hover{color:var(--text)}
.nav-tab.on{color:#000;background:var(--accent)}
[data-theme="light"] .nav-tab.on{color:#fff}
.nav-right{display:flex;align-items:center;gap:8px;flex-shrink:0}
.pill{font-size:.7rem;font-weight:700;padding:3px 10px;border-radius:16px;display:flex;align-items:center;gap:4px}
.pill-streak{background:var(--accentD);color:var(--accent)}
.theme-btn,.auth-btn{width:34px;height:34px;border-radius:9px;border:1px solid var(--border);background:var(--surface2);display:grid;place-items:center;cursor:pointer;font-size:15px;transition:all .15s;color:var(--text)}
.theme-btn:hover,.auth-btn:hover{border-color:var(--accent);transform:scale(1.06)}
.user-avatar{width:30px;height:30px;border-radius:50%;border:2px solid var(--accent);cursor:pointer;object-fit:cover}
.mobile-menu{display:none;background:none;border:none;color:var(--text);font-size:1.3rem;cursor:pointer}
@media(max-width:768px){.mobile-menu{display:block}.nav-tabs{display:none}.nav-tabs.open{display:flex;flex-direction:column;position:absolute;top:54px;left:0;right:0;background:var(--surface);border-bottom:1px solid var(--border);padding:6px;border-radius:0;z-index:999}}

/* â”€â”€ AUTH MODAL â”€â”€ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);z-index:2000;place-items:center}
.modal-overlay.show{display:grid}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:36px;max-width:400px;width:90%;text-align:center;animation:modalIn .3s ease}
@keyframes modalIn{from{opacity:0;transform:scale(.95) translateY(10px)}to{opacity:1;transform:none}}
.modal h2{font-family:'Outfit';font-weight:900;font-size:1.4rem;margin-bottom:6px}
.modal p{font-size:.85rem;color:var(--text2);margin-bottom:24px;line-height:1.6}
.google-btn{display:flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:12px 20px;background:#fff;color:#333;border:1px solid #ddd;border-radius:10px;font-family:'DM Sans';font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s}
.google-btn:hover{box-shadow:0 4px 15px rgba(0,0,0,.1);transform:translateY(-1px)}
.google-btn svg{width:20px;height:20px}
.modal-close{margin-top:16px;background:none;border:none;color:var(--text2);font-size:.82rem;cursor:pointer;font-family:'DM Sans'}
.modal-close:hover{color:var(--text)}
.user-menu{position:absolute;top:58px;right:16px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:8px;min-width:200px;box-shadow:var(--shadow);display:none;z-index:1001}
.user-menu.show{display:block}
.user-menu-item{display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:8px;font-size:.85rem;cursor:pointer;transition:background .15s;color:var(--text)}
.user-menu-item:hover{background:var(--surface2)}
.user-menu-email{padding:10px 14px;font-size:.75rem;color:var(--text3);border-bottom:1px solid var(--border);margin-bottom:4px}

/* â”€â”€ PAGES â”€â”€ */
main{position:relative;z-index:1;padding-top:54px;min-height:100vh}
.pg{display:none;padding:24px 16px;max-width:1200px;margin:0 auto;animation:fadeUp .3s ease}
.pg.on{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

/* â”€â”€ SHARED â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:20px;transition:all .2s}
.card:hover{box-shadow:var(--glow)}
.badge{font-size:.62rem;font-weight:700;padding:2px 9px;border-radius:14px;letter-spacing:.4px;text-transform:uppercase}
.sec-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px}
.sec-hdr h2{font-family:'Outfit';font-size:1.5rem;font-weight:900;letter-spacing:-.4px}
.back-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text);font-family:'DM Sans';font-size:.8rem;font-weight:600;padding:7px 16px;border-radius:8px;cursor:pointer;transition:all .15s}
.back-btn:hover{border-color:var(--accent)}
.btn{font-family:'DM Sans';font-size:.8rem;font-weight:600;padding:8px 20px;border-radius:8px;cursor:pointer;border:none;transition:all .15s}
.btn-p{background:var(--accent);color:#000}
.btn-p:hover{box-shadow:0 4px 15px rgba(0,229,160,.2)}
.btn-s{background:var(--surface2);color:var(--text);border:1px solid var(--border)}
.btn-s:hover{border-color:var(--accent)}
.btn-ac2{background:var(--ac2);color:#fff}
.btn-danger{background:var(--ac3D);color:var(--ac3);border:1px solid rgba(255,107,107,.2)}
.tabs{display:flex;gap:1px;background:var(--surface);padding:2px;border-radius:9px;flex-wrap:wrap}
.tab{background:none;border:none;color:var(--text2);font-family:'DM Sans';font-size:.74rem;font-weight:600;padding:5px 11px;border-radius:7px;cursor:pointer;transition:all .15s;white-space:nowrap}
.tab:hover{color:var(--text)}
.tab.on{background:var(--accent);color:#000}
[data-theme="light"] .tab.on{color:#fff}

/* â”€â”€ DASHBOARD â”€â”€ */
.hero h1{font-family:'Outfit';font-size:2.4rem;font-weight:900;line-height:1.06;letter-spacing:-1.5px;margin-bottom:5px}
.grad{background:linear-gradient(135deg,var(--accent),var(--ac2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:.95rem;margin-bottom:24px}
.score-box{background:linear-gradient(135deg,var(--surface2),var(--surface3));border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:20px;display:flex;align-items:center;gap:22px;flex-wrap:wrap}
.score-ring{width:96px;height:96px;border-radius:50%;border:4px solid var(--accent);display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0}
.score-ring .num{font-family:'Outfit';font-size:1.9rem;font-weight:900;color:var(--accent)}
.score-ring .lbl{font-size:.55rem;color:var(--text2);text-transform:uppercase;letter-spacing:1px}
.score-info{flex:1;min-width:200px}
.score-info h3{font-family:'Outfit';font-size:.95rem;font-weight:700;margin-bottom:4px}
.score-info p{font-size:.8rem;color:var(--text2);line-height:1.6}
.stat-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-bottom:20px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:11px;padding:14px;text-align:center}
.stat-card .v{font-family:'JetBrains Mono';font-size:1.5rem;font-weight:700}
.stat-card .l{font-size:.65rem;color:var(--text2);text-transform:uppercase;letter-spacing:.7px;margin-top:1px}

/* Topic Table */
.topic-table{width:100%;border-collapse:separate;border-spacing:0;margin-bottom:20px;background:var(--surface);border:1px solid var(--border);border-radius:13px;overflow:hidden}
.topic-table th{font-size:.68rem;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;padding:12px 14px;text-align:left;border-bottom:1px solid var(--border);font-weight:600}
.topic-table td{padding:11px 14px;font-size:.85rem;border-bottom:1px solid var(--border)}
.topic-table tr:last-child td{border-bottom:none}
.topic-table .bar-cell{width:140px}
.mini-bar{height:6px;background:var(--surface3);border-radius:3px;overflow:hidden}
.mini-bar-fill{height:100%;border-radius:3px;transition:width .5s}
.topic-table .correct-col{color:var(--correct);font-weight:700;font-family:'JetBrains Mono';font-size:.82rem}
.topic-table .wrong-col{color:var(--wrong);font-weight:700;font-family:'JetBrains Mono';font-size:.82rem}

.history-box{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:18px;margin-bottom:20px}
.history-box h3{font-family:'Outfit';font-weight:800;font-size:.92rem;margin-bottom:14px}
.chart-wrap{width:100%;height:180px;position:relative}
.actions-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:10px}
.action{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:18px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.action:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:var(--glow)}
.action .ic{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;font-size:20px;margin-bottom:12px}
.action h3{font-family:'Outfit';font-weight:700;font-size:.92rem;margin-bottom:3px}
.action p{font-size:.76rem;color:var(--text2);line-height:1.5}

/* â”€â”€ MENTAL MATH â”€â”€ */
.cfg-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
.cfg{background:var(--surface);border:1px solid var(--border);color:var(--text);font-family:'DM Sans';font-size:.76rem;font-weight:600;padding:6px 14px;border-radius:7px;cursor:pointer;transition:all .15s}
.cfg:hover{border-color:var(--accent)}
.cfg.on{background:var(--accentD);border-color:var(--accent);color:var(--accent)}
.arena{background:var(--surface);border:1px solid var(--border);border-radius:15px;padding:32px;text-align:center;min-height:300px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
.arena-timer{position:absolute;top:12px;right:16px;font-family:'JetBrains Mono';font-size:1.4rem;font-weight:700;color:var(--accent)}
.arena-score{position:absolute;top:12px;left:16px;font-size:.82rem;color:var(--text2)}
.arena-score span{color:var(--accent);font-weight:700}
.arena-q{font-family:'JetBrains Mono';font-size:2.1rem;font-weight:700;margin-bottom:18px;letter-spacing:1px}
.arena-input{background:var(--bg);border:2px solid var(--border);color:var(--text);font-family:'JetBrains Mono';font-size:1.5rem;text-align:center;padding:10px 18px;border-radius:11px;width:190px;outline:none;transition:border .15s}
.arena-input:focus{border-color:var(--accent)}
.arena-input.ok{border-color:var(--correct);background:rgba(0,229,160,.03)}
.arena-input.no{border-color:var(--wrong);background:rgba(255,107,107,.03)}
.arena-fb{margin-top:8px;font-size:.82rem;font-weight:600;min-height:20px}
.arena-streak{margin-top:6px;font-size:.78rem;color:var(--text2)}
.start-btn{background:linear-gradient(135deg,var(--accent),#00c48c);border:none;color:#000;font-family:'Outfit';font-size:.92rem;font-weight:700;padding:11px 34px;border-radius:11px;cursor:pointer;transition:all .15s}
.start-btn:hover{transform:scale(1.04);box-shadow:0 4px 18px rgba(0,229,160,.2)}
.res-stats{display:flex;gap:18px;justify-content:center;flex-wrap:wrap;margin:18px 0}
.res-stat .v{font-family:'JetBrains Mono';font-size:1.7rem;font-weight:700}
.res-stat .l{font-size:.6rem;color:var(--text2);text-transform:uppercase;letter-spacing:1px}

/* â”€â”€ SHORTCUTS â”€â”€ */
.sc{background:var(--surface);border:1px solid var(--border);border-radius:11px;margin-bottom:8px;overflow:hidden}
.sc-h{padding:14px 18px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;transition:background .15s}
.sc-h:hover{background:var(--surface2)}
.sc-h h3{font-size:.88rem;font-weight:600;display:flex;align-items:center;gap:8px}
.sc-arr{transition:transform .2s;color:var(--text3)}
.sc-arr.open{transform:rotate(90deg)}
.sc-b{display:none;padding:0 18px 18px;border-top:1px solid var(--border)}
.sc-b.open{display:block;padding-top:14px}
.sc-b p,.sc-b li{font-size:.82rem;color:var(--text2);line-height:1.7}
.formula{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:12px 16px;margin:8px 0;font-family:'JetBrains Mono';font-size:.82rem;color:var(--accent);line-height:1.8;white-space:pre-wrap}
.ex-box{background:var(--ac2D);border-left:3px solid var(--ac2);padding:9px 13px;margin:8px 0;border-radius:0 7px 7px 0;font-size:.8rem;line-height:1.7}
.tip-box{background:var(--ac4D);border-left:3px solid var(--ac4);padding:9px 13px;margin:8px 0;border-radius:0 7px 7px 0;font-size:.8rem;line-height:1.7}

/* â”€â”€ PRACTICE â”€â”€ */
.pr-controls{display:flex;flex-direction:column;gap:10px;margin-bottom:16px}
.pr-filter-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.pr-filter-label{font-size:.72rem;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0;width:70px}
.q-counter{font-size:.78rem;color:var(--text2);font-weight:600}
.pr-bar{height:3px;background:var(--surface2);border-radius:2px;margin-bottom:16px;overflow:hidden}
.pr-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--ac2));border-radius:2px;transition:width .4s}
.q-card{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:22px;margin-bottom:14px}
.q-tags{display:flex;gap:5px;margin-bottom:12px;flex-wrap:wrap}
.q-tag{font-size:.6rem;font-weight:700;padding:2px 9px;border-radius:14px;letter-spacing:.3px}
.q-text{font-size:.92rem;line-height:1.7;margin-bottom:16px}
.q-opts{display:flex;flex-direction:column;gap:7px;margin-bottom:14px}
.q-opt{background:var(--bg);border:1.5px solid var(--border);border-radius:9px;padding:11px 15px;cursor:pointer;font-size:.87rem;transition:all .12s;display:flex;align-items:center;gap:9px}
.q-opt:hover{border-color:var(--ac2);background:var(--ac2D)}
.q-opt.sel{border-color:var(--ac2);background:var(--ac2D)}
.q-opt.ok{border-color:var(--correct);background:rgba(0,229,160,.06)}
.q-opt.no{border-color:var(--wrong);background:rgba(255,107,107,.06)}
.q-opt .lt{width:24px;height:24px;border-radius:50%;border:1.5px solid var(--border);display:grid;place-items:center;font-size:.72rem;font-weight:700;flex-shrink:0;transition:all .12s}
.q-opt.sel .lt{border-color:var(--ac2);background:var(--ac2);color:#fff}
.q-opt.ok .lt{border-color:var(--correct);background:var(--correct);color:#000}
.q-opt.no .lt{border-color:var(--wrong);background:var(--wrong);color:#fff}
.qc-box{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;padding:14px;background:var(--bg);border-radius:9px;border:1px solid var(--border);margin-bottom:14px}
.qc-col{text-align:center;padding:6px}
.qc-col h4{font-size:.65rem;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.qc-col .v{font-family:'JetBrains Mono';font-size:.95rem}
.qc-vs{font-family:'Outfit';font-weight:900;color:var(--text3);font-size:1rem}
.q-num{background:var(--bg);border:2px solid var(--border);color:var(--text);font-family:'JetBrains Mono';font-size:1rem;text-align:center;padding:8px 14px;border-radius:9px;width:150px;outline:none;margin-bottom:14px}
.q-num:focus{border-color:var(--ac2)}
.q-btns{display:flex;gap:8px;flex-wrap:wrap}
.expl{background:var(--bg);border:1px solid var(--border);border-radius:9px;padding:16px;margin-top:14px;display:none}
.expl.show{display:block}
.expl h4{font-size:.82rem;color:var(--accent);margin-bottom:5px;font-weight:700}
.expl .sc-lbl{color:var(--ac4);font-weight:700;font-size:.75rem;margin-top:8px;margin-bottom:2px}
.expl p{font-size:.8rem;line-height:1.7;color:var(--text2)}
.chart-title{font-size:.78rem;font-weight:700;margin-bottom:8px;text-align:center}

/* â”€â”€ CONCEPT CHIPS â”€â”€ */
.concept-chips{display:flex;gap:5px;flex-wrap:wrap}
.chip{font-size:.68rem;font-weight:600;padding:3px 10px;border-radius:14px;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text2);transition:all .15s}
.chip:hover{border-color:var(--accent);color:var(--text)}
.chip.on{background:var(--accentD);border-color:var(--accent);color:var(--accent)}

@media(max-width:768px){
.hero h1{font-size:1.7rem}
.score-box{flex-direction:column;align-items:flex-start}
.stat-row{grid-template-columns:repeat(2,1fr)}
.arena-q{font-size:1.5rem}
.arena{padding:22px 16px}
}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo" onclick="go('dash')"><div class="logo-icon">Q</div>GRE <span style="color:var(--accent)">170</span></div>
  <div class="nav-tabs" id="navTabs">
    <button class="nav-tab on" onclick="go('dash')">Dashboard</button>
    <button class="nav-tab" onclick="go('mm')">Mental Math</button>
    <button class="nav-tab" onclick="go('sc')">Shortcuts</button>
    <button class="nav-tab" onclick="go('pr')">Practice</button>
  </div>
  <div class="nav-right">
    <div class="pill pill-streak" id="navStreak">ğŸ”¥ 0</div>
    <button class="theme-btn" onclick="toggleTheme()" id="themeBtn" title="Toggle theme">ğŸŒ™</button>
    <div id="authArea">
      <button class="auth-btn" onclick="showAuthModal()" id="loginBtn" title="Sign in">ğŸ‘¤</button>
    </div>
    <button class="mobile-menu" onclick="document.getElementById('navTabs').classList.toggle('open')">â˜°</button>
  </div>
</nav>

<!-- AUTH MODAL -->
<div class="modal-overlay" id="authModal">
  <div class="modal">
    <h2>Welcome to GRE 170</h2>
    <p>Sign in with Google to save your progress across devices. Your data syncs automatically to the cloud.</p>
    <button class="google-btn" onclick="signInWithGoogle()">
      <svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
      Sign in with Google
    </button>
    <button class="modal-close" onclick="hideAuthModal()">Continue without signing in</button>
  </div>
</div>

<!-- USER MENU -->
<div class="user-menu" id="userMenu">
  <div class="user-menu-email" id="userEmail">â€”</div>
  <div class="user-menu-item" onclick="syncNow()">ğŸ”„ Sync Now</div>
  <div class="user-menu-item" onclick="exportData()">ğŸ“¥ Export Data</div>
  <div class="user-menu-item" onclick="signOutUser()">ğŸšª Sign Out</div>
</div>

<main>
<!-- â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â• -->
<div class="pg on" id="pg-dash">
  <div class="hero" style="padding:14px 0 6px">
    <h1>Train Your Brain.<br>Score <span class="grad">170</span>.</h1>
    <p>1000+ questions Â· Mental math drills Â· Every shortcut Â· Cloud sync</p>
  </div>
  <div class="score-box" id="scoreBox">
    <div class="score-ring" id="scoreRing"><div class="num" id="predScore">--</div><div class="lbl">Predicted</div></div>
    <div class="score-info"><h3>ğŸ“Š Predicted GRE Quant Score</h3><p id="scoreAdvice">Answer at least 20 questions to unlock score prediction.</p></div>
  </div>
  <div class="stat-row" id="statRow">
    <div class="stat-card"><div class="v" style="color:var(--accent)" id="dTot">0</div><div class="l">Total Done</div></div>
    <div class="stat-card"><div class="v" style="color:var(--correct)" id="dCor">0</div><div class="l">Correct</div></div>
    <div class="stat-card"><div class="v" style="color:var(--wrong)" id="dWrong">0</div><div class="l">Incorrect</div></div>
    <div class="stat-card"><div class="v" style="color:var(--ac2)" id="dAcc">0%</div><div class="l">Accuracy</div></div>
    <div class="stat-card"><div class="v" style="color:var(--ac4)" id="dBest">0</div><div class="l">Best Streak</div></div>
    <div class="stat-card"><div class="v" style="color:var(--ac5)" id="dAvg">--</div><div class="l">Avg Time (s)</div></div>
  </div>

  <h3 style="font-family:Outfit;font-weight:800;font-size:.92rem;margin-bottom:10px">ğŸ“ˆ Performance by Topic</h3>
  <table class="topic-table" id="topicTable"><thead><tr><th>Topic</th><th>Done</th><th>âœ… Correct</th><th>âŒ Wrong</th><th>Accuracy</th><th class="bar-cell">Progress</th></tr></thead><tbody id="topicBody"></tbody></table>

  <div class="history-box"><h3>ğŸ“‰ Accuracy Trend</h3><div class="chart-wrap"><canvas id="histCanvas"></canvas></div></div>

  <h3 style="font-family:Outfit;font-weight:800;font-size:.92rem;margin-bottom:10px">ğŸš€ Quick Start</h3>
  <div class="actions-grid">
    <div class="action" onclick="go('mm')"><div class="ic" style="background:var(--accentD);color:var(--accent)">âš¡</div><h3>Mental Math</h3><p>60-second speed drills</p></div>
    <div class="action" onclick="go('sc')"><div class="ic" style="background:var(--ac2D);color:var(--ac2)">ğŸ§ </div><h3>Shortcuts</h3><p>40+ techniques</p></div>
    <div class="action" onclick="go('pr')"><div class="ic" style="background:var(--ac3D);color:var(--ac3)">ğŸ¯</div><h3>Practice</h3><p>1000+ questions</p></div>
    <div class="action" onclick="startMini()"><div class="ic" style="background:var(--ac4D);color:var(--ac4)">â±ï¸</div><h3>Mini Test</h3><p>20 random, timed</p></div>
  </div>
  <div style="margin-top:18px;text-align:center"><button class="btn btn-danger" onclick="if(confirm('Reset ALL progress?')){resetAll()}">ğŸ—‘ï¸ Reset Progress</button></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• MENTAL MATH â•â•â•â•â•â•â•â•â•â•â• -->
<div class="pg" id="pg-mm">
  <div class="sec-hdr"><h2>âš¡ Mental Math Gym</h2><button class="back-btn" onclick="go('dash')">â† Back</button></div>
  <div class="cfg-row" id="mmTypes">
    <button class="cfg on" onclick="setMM(this,'add')">Addition</button>
    <button class="cfg" onclick="setMM(this,'sub')">Subtraction</button>
    <button class="cfg" onclick="setMM(this,'mul')">Multiply</button>
    <button class="cfg" onclick="setMM(this,'div')">Division</button>
    <button class="cfg" onclick="setMM(this,'pct')">Percent</button>
    <button class="cfg" onclick="setMM(this,'sq')">Squares</button>
    <button class="cfg" onclick="setMM(this,'frac')">Fractions</button>
    <button class="cfg" onclick="setMM(this,'pow')">Powers</button>
    <button class="cfg" onclick="setMM(this,'mix')">ğŸ”€ Mixed</button>
  </div>
  <div class="cfg-row" id="mmDiffs">
    <span style="font-size:.78rem;color:var(--text2);align-self:center">Level:</span>
    <button class="cfg on" onclick="setMMD(this,'easy')">Easy</button>
    <button class="cfg" onclick="setMMD(this,'med')">Medium</button>
    <button class="cfg" onclick="setMMD(this,'hard')">Hard</button>
    <button class="cfg" onclick="setMMD(this,'insane')">ğŸ”¥ Insane</button>
  </div>
  <div class="arena" id="mmArena">
    <div id="mmIdle" style="display:flex;flex-direction:column;align-items:center"><p style="font-size:1rem;margin-bottom:5px">Ready to train?</p><p style="font-size:.8rem;color:var(--text2);margin-bottom:18px">60-second blitz. Type fast.</p><button class="start-btn" onclick="startMM()">START DRILL</button></div>
    <div id="mmActive" style="display:none;width:100%;flex-direction:column;align-items:center"><div class="arena-timer" id="mmTimerEl">60</div><div class="arena-score">Score: <span id="mmScoreLive">0</span></div><div class="arena-q" id="mmQ"></div><input type="text" class="arena-input mono" id="mmInput" autocomplete="off" inputmode="decimal" placeholder="?"><div class="arena-streak" id="mmStreakEl"></div><div class="arena-fb" id="mmFb"></div></div>
    <div id="mmRes" style="display:none"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• SHORTCUTS â•â•â•â•â•â•â•â•â•â•â• -->
<div class="pg" id="pg-sc">
  <div class="sec-hdr"><h2>ğŸ§  Shortcut Arsenal</h2><button class="back-btn" onclick="go('dash')">â† Back</button></div>
  <div class="tabs" id="scTabs"></div>
  <div id="scGrid" style="margin-top:12px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• PRACTICE â•â•â•â•â•â•â•â•â•â•â• -->
<div class="pg" id="pg-pr">
  <div class="sec-hdr"><h2>ğŸ¯ Practice Arena</h2><button class="back-btn" onclick="go('dash')">â† Back</button></div>
  <div class="pr-controls">
    <div class="pr-filter-row"><span class="pr-filter-label">Topic</span><div class="tabs" id="prTopicTabs"></div></div>
    <div class="pr-filter-row"><span class="pr-filter-label">Difficulty</span><div class="tabs" id="prDiffTabs"></div></div>
    <div class="pr-filter-row"><span class="pr-filter-label">Concept</span><div class="concept-chips" id="prConcepts"></div></div>
    <div style="display:flex;justify-content:space-between;align-items:center"><div class="q-counter" id="qCtr">Q 1</div><button class="btn btn-s" onclick="loadBatch()" style="font-size:.72rem;padding:5px 12px">â†» New Batch</button></div>
  </div>
  <div class="pr-bar"><div class="pr-fill" id="prFill" style="width:0"></div></div>
  <div id="prArea"></div>
  <div style="text-align:center;margin-top:14px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
    <button class="btn btn-ac2" onclick="nextQ()">Next Question â†’</button>
    <button class="btn btn-s" onclick="loadBatch()">Load 10 More</button>
  </div>
</div>
</main>

<!-- Firebase SDKs (v9 compat for simplicity on GitHub Pages) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>

const FIREBASE_CONFIG = {
  apiKey: "AIzaSyBZ3RSfNeGE5ZeiDgyet7XMlwQ2AZTj_Go",
  authDomain: "gre-quant-170.firebaseapp.com",
  projectId: "gre-quant-170",
  storageBucket: "gre-quant-170.firebasestorage.app",
  messagingSenderId: "317295183375",
  appId: "1:317295183375:web:3ee06d4f9cacc4acee857a"
};

let firebaseReady = false;
let db = null;
let auth = null;
let currentUser = null;

try {
  if (FIREBASE_CONFIG.apiKey !== "YOUR_API_KEY_HERE") {
    firebase.initializeApp(FIREBASE_CONFIG);
    auth = firebase.auth();
    db = firebase.firestore();
    firebaseReady = true;
    auth.onAuthStateChanged(user => {
      currentUser = user;
      updateAuthUI();
      if (user) loadCloudData();
    });
  }
} catch(e) { console.log('Firebase not configured, using localStorage only'); }

function showAuthModal() {
  if (!firebaseReady) { alert('Firebase not configured yet.\\n\\nTo enable Google Sign-In:\\n1. Create a Firebase project at console.firebase.google.com\\n2. Enable Google Authentication\\n3. Enable Firestore\\n4. Replace the FIREBASE_CONFIG in index.html\\n5. Add your GitHub Pages domain to authorized domains\\n\\nYour progress is still saved locally!'); return; }
  if (currentUser) { toggleUserMenu(); return; }
  document.getElementById('authModal').classList.add('show');
}
function hideAuthModal() { document.getElementById('authModal').classList.remove('show'); }
function toggleUserMenu() {
  const m = document.getElementById('userMenu');
  m.classList.toggle('show');
  setTimeout(() => document.addEventListener('click', function closeMenu(e) { if (!m.contains(e.target)) { m.classList.remove('show'); document.removeEventListener('click', closeMenu); } }), 10);
}

async function signInWithGoogle() {
  if (!firebaseReady) return;
  try {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
    hideAuthModal();
  } catch(e) { console.error('Auth error:', e); alert('Sign-in failed: ' + e.message); }
}

async function signOutUser() {
  if (auth) await auth.signOut();
  currentUser = null;
  updateAuthUI();
  document.getElementById('userMenu').classList.remove('show');
}

function updateAuthUI() {
  const area = document.getElementById('authArea');
  if (currentUser) {
    const img = currentUser.photoURL || '';
    area.innerHTML = img
      ? `<img class="user-avatar" src="${img}" onclick="toggleUserMenu()" title="${currentUser.displayName}">`
      : `<button class="auth-btn" onclick="toggleUserMenu()" title="${currentUser.displayName}">ğŸ˜Š</button>`;
    document.getElementById('userEmail').textContent = currentUser.email;
  } else {
    area.innerHTML = `<button class="auth-btn" onclick="showAuthModal()" id="loginBtn" title="Sign in">ğŸ‘¤</button>`;
  }
}

async function saveToCloud() {
  if (!firebaseReady || !currentUser || !db) return;
  try { await db.collection('users').doc(currentUser.uid).set({ progress: JSON.stringify(S), updatedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge: true }); } catch(e) { console.error('Cloud save error:', e); }
}

async function loadCloudData() {
  if (!firebaseReady || !currentUser || !db) return;
  try {
    const doc = await db.collection('users').doc(currentUser.uid).get();
    if (doc.exists && doc.data().progress) {
      const cloud = JSON.parse(doc.data().progress);
      if (cloud.totalAnswered > S.totalAnswered) { S = cloud; S.version = 4; saveLocal(); renderDash(); }
      else if (S.totalAnswered > cloud.totalAnswered) { saveToCloud(); }
    } else { saveToCloud(); }
  } catch(e) { console.error('Cloud load error:', e); }
}

function syncNow() { saveToCloud().then(() => alert('Synced to cloud!')); document.getElementById('userMenu').classList.remove('show'); }
function exportData() {
  const blob = new Blob([JSON.stringify(S, null, 2)], {type: 'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'gre170_progress.json'; a.click();
  document.getElementById('userMenu').classList.remove('show');
}

// â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•
const LS = 'gre170_v4';
let S = loadLocal();
function loadLocal() {
  try { const d = JSON.parse(localStorage.getItem(LS)); if (d && d.version === 4) return d; } catch(e) {}
  return { version:4, totalAnswered:0, totalCorrect:0, bestStreak:0, streak:0, mmDone:0, topics:{
    arithmetic:{done:0,correct:0}, algebra:{done:0,correct:0}, geometry:{done:0,correct:0}, coordinate:{done:0,correct:0}, data:{done:0,correct:0}
  }, history:[], times:[] };
}
function saveLocal() { localStorage.setItem(LS, JSON.stringify(S)); }
function saveAll() { saveLocal(); saveToCloud(); }
function resetAll() { S = loadLocal.__proto__ ? { version:4,totalAnswered:0,totalCorrect:0,bestStreak:0,streak:0,mmDone:0,topics:{arithmetic:{done:0,correct:0},algebra:{done:0,correct:0},geometry:{done:0,correct:0},coordinate:{done:0,correct:0},data:{done:0,correct:0}},history:[],times:[] } : loadLocal(); localStorage.removeItem(LS); S = {version:4,totalAnswered:0,totalCorrect:0,bestStreak:0,streak:0,mmDone:0,topics:{arithmetic:{done:0,correct:0},algebra:{done:0,correct:0},geometry:{done:0,correct:0},coordinate:{done:0,correct:0},data:{done:0,correct:0}},history:[],times:[]}; saveAll(); renderDash(); }

// â•â•â•â•â•â•â• THEME â•â•â•â•â•â•â•
function toggleTheme() {
  const t = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', t);
  document.getElementById('themeBtn').textContent = t === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
  localStorage.setItem('gre170_theme', t);
}
(function(){ const t = localStorage.getItem('gre170_theme'); if(t){document.documentElement.setAttribute('data-theme',t);document.getElementById('themeBtn').textContent=t==='dark'?'ğŸŒ™':'â˜€ï¸';}})();

// â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•
function go(pg) {
  document.querySelectorAll('.pg').forEach(p => p.classList.remove('on'));
  document.getElementById('pg-'+pg).classList.add('on');
  document.querySelectorAll('.nav-tab').forEach((b,i) => b.classList.toggle('on', i === {dash:0,mm:1,sc:2,pr:3}[pg]));
  document.getElementById('navTabs').classList.remove('open');
  window.scrollTo(0,0);
  if (pg==='dash') renderDash();
  if (pg==='sc') renderSC();
  if (pg==='pr') { if(!prInit) initPR(); renderQ(); }
}

// â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•
const TOPICS = [
  {k:'arithmetic',n:'Arithmetic',icon:'ğŸ”¢',c:'var(--accent)'},
  {k:'algebra',n:'Algebra',icon:'ğŸ“',c:'var(--ac2)'},
  {k:'geometry',n:'Geometry',icon:'ğŸ“',c:'var(--ac3)'},
  {k:'coordinate',n:'Coord. Geometry',icon:'ğŸ“',c:'var(--ac4)'},
  {k:'data',n:'Data Analysis',icon:'ğŸ“Š',c:'var(--ac5)'}
];

function renderDash() {
  const s = S;
  document.getElementById('dTot').textContent = s.totalAnswered;
  document.getElementById('dCor').textContent = s.totalCorrect;
  document.getElementById('dWrong').textContent = s.totalAnswered - s.totalCorrect;
  document.getElementById('dAcc').textContent = s.totalAnswered ? Math.round(s.totalCorrect/s.totalAnswered*100)+'%' : '0%';
  document.getElementById('dBest').textContent = s.bestStreak;
  document.getElementById('dAvg').textContent = s.times.length ? (s.times.reduce((a,b)=>a+b,0)/s.times.length).toFixed(1) : '--';
  document.getElementById('navStreak').textContent = 'ğŸ”¥ ' + s.streak;

  const pred = s.totalAnswered >= 20 ? Math.min(170, Math.max(130, 130+Math.round(40*Math.pow(Math.min(1,s.totalCorrect/s.totalAnswered*1.05+.02),.75)))) : null;
  document.getElementById('predScore').textContent = pred || '--';
  if (pred) {
    const p = (pred-130)/40; const h = p*120;
    document.getElementById('scoreRing').style.borderColor = `hsl(${h},80%,50%)`;
    document.querySelector('.score-ring .num').style.color = `hsl(${h},80%,50%)`;
  }
  document.getElementById('scoreAdvice').textContent = !pred ? 'Answer at least 20 questions to unlock.' : pred>=168 ? 'ğŸ† 170-level performance! Maintain accuracy.' : pred>=165 ? 'ğŸ”¥ Excellent! Eliminate careless errors to hit 170.' : pred>=160 ? 'ğŸ‘ Strong! Work on weak topics & QC strategies.' : pred>=155 ? 'ğŸ“ˆ Good! Drill mental math & learn shortcuts.' : pred>=150 ? 'ğŸ’ª Building up! Master arithmetic shortcuts first.' : 'ğŸŒ± Keep going! Focus one topic at a time.';

  // Topic table
  document.getElementById('topicBody').innerHTML = TOPICS.map(t => {
    const d = s.topics[t.k]; const wrong = d.done - d.correct;
    const acc = d.done ? Math.round(d.correct/d.done*100) : 0;
    return `<tr><td style="font-weight:600">${t.icon} ${t.n}</td><td>${d.done}</td><td class="correct-col">${d.correct}</td><td class="wrong-col">${wrong}</td><td>${acc}%</td><td class="bar-cell"><div class="mini-bar"><div class="mini-bar-fill" style="width:${acc}%;background:${t.c}"></div></div></td></tr>`;
  }).join('') + `<tr style="font-weight:700;background:var(--surface2)"><td>TOTAL</td><td>${s.totalAnswered}</td><td class="correct-col">${s.totalCorrect}</td><td class="wrong-col">${s.totalAnswered-s.totalCorrect}</td><td>${s.totalAnswered?Math.round(s.totalCorrect/s.totalAnswered*100):0}%</td><td></td></tr>`;

  drawHist();
}

function drawHist() {
  const c = document.getElementById('histCanvas'); const ctx = c.getContext('2d');
  c.width = c.parentElement.offsetWidth; c.height = 180; ctx.clearRect(0,0,c.width,c.height);
  const h = S.history.slice(-30); if(h.length<2){ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--text3');ctx.font='12px DM Sans';ctx.textAlign='center';ctx.fillText('Answer more questions to see trends',c.width/2,90);return;}
  const W=c.width,H=c.height,p={l:36,r:16,t:16,b:24},pw=W-p.l-p.r,ph=H-p.t-p.b;
  const tc=getComputedStyle(document.documentElement).getPropertyValue('--text3').trim();
  const lc=getComputedStyle(document.documentElement).getPropertyValue('--border').trim();
  const ac=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
  ctx.strokeStyle=lc;ctx.lineWidth=.5;ctx.font='9px JetBrains Mono';ctx.fillStyle=tc;ctx.textAlign='right';
  for(let i=0;i<=4;i++){const y=p.t+ph*(1-i/4);ctx.beginPath();ctx.moveTo(p.l,y);ctx.lineTo(W-p.r,y);ctx.stroke();ctx.fillText(i*25+'%',p.l-4,y+3);}
  ctx.strokeStyle=ac;ctx.lineWidth=2;ctx.lineJoin='round';ctx.beginPath();
  h.forEach((pt,i)=>{const x=p.l+i/(h.length-1)*pw;const a=pt.t?pt.c/pt.t:0;const y=p.t+ph-a*ph;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});ctx.stroke();
  h.forEach((pt,i)=>{const x=p.l+i/(h.length-1)*pw;const a=pt.t?pt.c/pt.t:0;const y=p.t+ph-a*ph;ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fillStyle=ac;ctx.fill();});
}

// â•â•â•â•â•â•â• MENTAL MATH â•â•â•â•â•â•â•
let mmT='add',mmD='easy',mmTimer=null,mmTL=60,mmSc=0,mmSt=0,mmBs=0,mmAn=0,mmTt=0;
function setMM(b,t){document.querySelectorAll('#mmTypes .cfg').forEach(x=>x.classList.remove('on'));b.classList.add('on');mmT=t;}
function setMMD(b,d){document.querySelectorAll('#mmDiffs .cfg').forEach(x=>x.classList.remove('on'));b.classList.add('on');mmD=d;}
const Ri=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const pick=a=>a[Ri(0,a.length-1)];
const shuf=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=Ri(0,i);[b[i],b[j]]=[b[j],b[i]];}return b;};

function genMM(){
  const lo={easy:2,med:10,hard:20,insane:50}[mmD],hi={easy:20,med:99,hard:200,insane:999}[mmD];
  const ts=mmT==='mix'?['add','sub','mul','div','pct','sq','frac','pow']:[mmT];const t=pick(ts);let q,a;
  switch(t){
    case'add':{let x=Ri(lo,hi),y=Ri(lo,hi);q=`${x} + ${y}`;a=x+y;break}
    case'sub':{let x=Ri(lo,hi),y=Ri(lo,Math.min(x,hi));q=`${x} âˆ’ ${y}`;a=x-y;break}
    case'mul':{let mx={easy:12,med:25,hard:50,insane:99}[mmD],x=Ri(2,mx),y=Ri(2,mmD==='insane'?30:15);q=`${x} Ã— ${y}`;a=x*y;break}
    case'div':{let y=Ri(2,{easy:10,med:15,hard:25,insane:40}[mmD]),m=Ri(2,{easy:10,med:20,hard:40,insane:60}[mmD]);q=`${y*m} Ã· ${y}`;a=m;break}
    case'pct':{let p=pick([5,10,15,20,25,30,40,50,60,75]),b=Ri(2,{easy:20,med:50,hard:100,insane:200}[mmD])*10;q=`${p}% of ${b}`;a=p*b/100;break}
    case'sq':{let x=Ri(2,{easy:15,med:25,hard:35,insane:50}[mmD]);if(Math.random()<.3&&mmD!=='easy'){q=`${x}Â³`;a=x**3}else{q=`${x}Â²`;a=x**2}break}
    case'frac':{let[n,d]=pick([[1,2],[1,3],[2,3],[1,4],[3,4],[1,5],[2,5],[3,5],[1,6],[5,6],[1,8],[3,8],[5,8],[7,8]]),b=d*Ri(2,{easy:10,med:20,hard:30,insane:50}[mmD]);q=`${n}/${d} of ${b}`;a=n*b/d;break}
    case'pow':{let b=Ri(2,{easy:5,med:8,hard:10,insane:12}[mmD]),e=Ri(2,{easy:3,med:4,hard:5,insane:6}[mmD]);if(b>5)e=Math.min(e,3);q=`${b}^${e}`;a=b**e;break}
  }
  return{q,a:Math.round(a*1000)/1000};
}
function startMM(){
  mmSc=0;mmSt=0;mmBs=0;mmTt=0;mmTL=60;
  document.getElementById('mmIdle').style.display='none';document.getElementById('mmRes').style.display='none';
  const act=document.getElementById('mmActive');act.style.display='flex';
  document.getElementById('mmScoreLive').textContent='0';document.getElementById('mmTimerEl').textContent='60';document.getElementById('mmTimerEl').style.color='var(--accent)';document.getElementById('mmFb').textContent='';document.getElementById('mmStreakEl').innerHTML='';
  nxtMM();document.getElementById('mmInput').focus();document.getElementById('mmInput').onkeydown=mmKey;
  mmTimer=setInterval(()=>{mmTL--;document.getElementById('mmTimerEl').textContent=mmTL;if(mmTL<=10)document.getElementById('mmTimerEl').style.color='var(--ac3)';if(mmTL<=0)endMM();},1000);
}
function nxtMM(){const p=genMM();mmAn=p.a;document.getElementById('mmQ').textContent=p.q;const i=document.getElementById('mmInput');i.value='';i.className='arena-input mono';}
function mmKey(e){if(e.key==='Enter'){const i=document.getElementById('mmInput'),v=parseFloat(i.value);if(isNaN(v))return;mmTt++;
  if(Math.abs(v-mmAn)<.01){mmSc++;mmSt++;if(mmSt>mmBs)mmBs=mmSt;i.className='arena-input mono ok';document.getElementById('mmFb').innerHTML='<span style="color:var(--correct)">âœ“</span>';document.getElementById('mmScoreLive').textContent=mmSc;if(mmSt>=3)document.getElementById('mmStreakEl').innerHTML=`ğŸ”¥ ${mmSt}`;}
  else{mmSt=0;i.className='arena-input mono no';document.getElementById('mmFb').innerHTML=`<span style="color:var(--wrong)">âœ— ${mmAn}</span>`;document.getElementById('mmStreakEl').innerHTML='';}
  setTimeout(nxtMM,300);}}
function endMM(){
  clearInterval(mmTimer);document.getElementById('mmInput').onkeydown=null;document.getElementById('mmActive').style.display='none';
  const acc=mmTt?Math.round(mmSc/mmTt*100):0;S.mmDone++;if(mmBs>S.bestStreak)S.bestStreak=mmBs;S.history.push({c:mmSc,t:mmTt});if(S.history.length>100)S.history=S.history.slice(-100);saveAll();
  const g=acc>=95?'ğŸ† LEGENDARY':acc>=80?'ğŸ”¥ Excellent':acc>=60?'ğŸ‘ Good':'ğŸ’ª Keep Going';
  document.getElementById('mmRes').style.display='block';document.getElementById('mmRes').innerHTML=`<h3 style="font-family:Outfit;font-weight:900;font-size:1.2rem;margin-bottom:14px">${g}</h3><div class="res-stats"><div class="res-stat"><div class="v" style="color:var(--accent)">${mmSc}</div><div class="l">Correct</div></div><div class="res-stat"><div class="v">${mmTt}</div><div class="l">Attempted</div></div><div class="res-stat"><div class="v" style="color:var(--ac2)">${acc}%</div><div class="l">Accuracy</div></div><div class="res-stat"><div class="v" style="color:var(--ac4)">${mmBs}ğŸ”¥</div><div class="l">Best Streak</div></div></div><button class="start-btn" onclick="startMM()">GO AGAIN</button> <button class="back-btn" style="margin-left:8px" onclick="document.getElementById('mmRes').style.display='none';document.getElementById('mmIdle').style.display='flex';">Settings</button>`;
}

// â•â•â•â•â•â•â• SHORTCUTS â•â•â•â•â•â•â•
const SC=[
{c:'arithmetic',t:'Multiplying by 11',b:`<p>Split digits, put sum in middle.</p><div class="formula">ab Ã— 11 = a(a+b)b   Carry if sumâ‰¥10</div><div class="ex-box"><b>36Ã—11â†’396 Â· 85Ã—11â†’935</b></div>`},
{c:'arithmetic',t:'Squaring Numbers Ending in 5',b:`<div class="formula">n5Â² = n(n+1) | 25</div><div class="ex-box">35Â²=1225 Â· 75Â²=5625</div>`},
{c:'arithmetic',t:'Difference of Squares Trick',b:`<div class="formula">aÃ—b = ((a+b)/2)Â² âˆ’ ((aâˆ’b)/2)Â²</div><div class="ex-box">48Ã—52 = 50Â²âˆ’2Â² = 2496</div>`},
{c:'arithmetic',t:'Fractionâ†”Decimal Must-Knows',b:`<div class="formula">1/2=.5  1/3=.333 1/4=.25 1/5=.2 1/6=.167\n1/7â‰ˆ.143 1/8=.125 1/9=.111 1/11â‰ˆ.091\n3/8=.375 5/8=.625 7/8=.875</div>`},
{c:'arithmetic',t:'Percentage Swap',b:`<div class="formula">x% of y = y% of x\nSuccessive: a%+b%+ab/100</div><div class="ex-box">+20% then âˆ’10% = 20âˆ’10âˆ’2 = +8%</div>`},
{c:'arithmetic',t:'Divisibility Rules',b:`<div class="formula">Ã·3:digit sum  Ã·4:last 2 digits  Ã·6:Ã·2&Ã·3\nÃ·8:last 3 digits  Ã·9:digit sum  Ã·11:alt sum</div>`},
{c:'arithmetic',t:'Remainder Cyclicity',b:`<div class="formula">Powers of 2 mod 10: 2,4,8,6 (cycle 4)\nPowers of 3 mod 10: 3,9,7,1 (cycle 4)\nPowers of 7 mod 10: 7,9,3,1 (cycle 4)</div>`},
{c:'arithmetic',t:'Multiply by 5/25/50',b:`<div class="formula">Ã—5 = Ã—10Ã·2   Ã—25 = Ã—100Ã·4   Ã—50 = Ã—100Ã·2</div>`},
{c:'arithmetic',t:'LCM & GCD',b:`<div class="formula">LCM(a,b) = aÃ—b/GCD(a,b)\nGCD: prime factorize â†’ min powers\nLCM: prime factorize â†’ max powers</div>`},
{c:'arithmetic',t:'Estimation',b:`<div class="formula">âˆš2â‰ˆ1.414 âˆš3â‰ˆ1.732 âˆš5â‰ˆ2.236 Ï€â‰ˆ3.14\nRound to friendly numbers when choices spread</div>`},
{c:'algebra',t:'Backsolving',b:`<p>Start with choice C (middle). Too bigâ†’go smaller.</p><div class="tip-box">When: "What is the value of" + integer choices</div>`},
{c:'algebra',t:'Plugging In Numbers',b:`<div class="formula">Use 2,3,5,10,100. Avoid 0 and 1.\nWork through, check which answer matches.</div>`},
{c:'algebra',t:'Quadratic Identities',b:`<div class="formula">(a+b)Â²=aÂ²+2ab+bÂ²  (aâˆ’b)Â²=aÂ²âˆ’2ab+bÂ²\n(a+b)(aâˆ’b)=aÂ²âˆ’bÂ²\naÂ²+bÂ²=(a+b)Â²âˆ’2ab</div>`},
{c:'algebra',t:'Inequalities',b:`<div class="formula">Ã—negativeâ†’FLIP  a>b>0â†’1/a<1/b\n|x|<aâ†’âˆ’a<x<a  |x|>aâ†’x>a OR x<âˆ’a\nxÂ²<9â†’âˆ’3<x<3</div>`},
{c:'algebra',t:'Systems: Add/Subtract',b:`<p>If asked for x+y or xy, try combining equations directly.</p>`},
{c:'algebra',t:'Exponent Rules',b:`<div class="formula">aáµÂ·aâ¿=aáµâºâ¿  aáµ/aâ¿=aáµâ»â¿  (aáµ)â¿=aáµâ¿\naâ°=1  aâ»â¿=1/aâ¿  Same baseâ†’equate exp</div>`},
{c:'algebra',t:'Sequences',b:`<div class="formula">Arith: aâ‚™=aâ‚+(nâˆ’1)d  Sum=n(aâ‚+aâ‚™)/2\nGeo: aâ‚™=aâ‚Â·râ¿â»Â¹  Sum=aâ‚(1âˆ’râ¿)/(1âˆ’r)</div>`},
{c:'algebra',t:'Wordâ†’Equation',b:`<div class="formula">"is"â†’=  "of"â†’Ã—  "more than"â†’+\n"less than"â†’âˆ’  "per"â†’Ã·  "twice"â†’2Ã—</div>`},
{c:'geometry',t:'Special Triangles',b:`<div class="formula">30-60-90: x:xâˆš3:2x\n45-45-90: x:x:xâˆš2\nTriples: 3-4-5, 5-12-13, 8-15-17, 7-24-25</div>`},
{c:'geometry',t:'Circle Formulas',b:`<div class="formula">C=2Ï€r  A=Ï€rÂ²\nArc=(Î¸/360)Â·2Ï€r  Sector=(Î¸/360)Â·Ï€rÂ²</div>`},
{c:'geometry',t:'Volume Formulas',b:`<div class="formula">Cylinder:Ï€rÂ²h  Cone:â…“Ï€rÂ²h  Sphere:4/3Ï€rÂ³\nCube:sÂ³  Rectangular:lwh</div>`},
{c:'geometry',t:'Inscribed Circle (Right â–³)',b:`<div class="formula">r = (a+bâˆ’c)/2  (legs a,b; hyp c)</div><div class="ex-box">Legs 8,15â†’hyp 17â†’r=3</div>`},
{c:'geometry',t:'Similar Figures',b:`<div class="formula">Side ratio k â†’ Area ratio kÂ² â†’ Volume kÂ³</div>`},
{c:'geometry',t:'Polygon Angles',b:`<div class="formula">Sum interior=(nâˆ’2)Â·180Â°\nEach(regular)=(nâˆ’2)Â·180Â°/n\nExterior always sum to 360Â°</div>`},
{c:'coordinate',t:'Core Formulas',b:`<div class="formula">Dist=âˆš((Î”x)Â²+(Î”y)Â²)\nMidpoint=((xâ‚+xâ‚‚)/2,(yâ‚+yâ‚‚)/2)\nSlope=(yâ‚‚âˆ’yâ‚)/(xâ‚‚âˆ’xâ‚)</div>`},
{c:'coordinate',t:'Line Shortcuts',b:`<div class="formula">Ax+By=C â†’ slope=âˆ’A/B, y-int=C/B\nParallel=same slope  Perp=neg reciprocal</div>`},
{c:'coordinate',t:'Reflections',b:`<div class="formula">x-axis:(x,âˆ’y) y-axis:(âˆ’x,y)\nOrigin:(âˆ’x,âˆ’y) y=x:(y,x)</div>`},
{c:'coordinate',t:'Circle Equation',b:`<div class="formula">(xâˆ’h)Â²+(yâˆ’k)Â²=rÂ²  Center(h,k)</div>`},
{c:'coordinate',t:'Shoelace Area',b:`<div class="formula">Â½|xâ‚(yâ‚‚âˆ’yâ‚ƒ)+xâ‚‚(yâ‚ƒâˆ’yâ‚)+xâ‚ƒ(yâ‚âˆ’yâ‚‚)|</div>`},
{c:'data',t:'Mean/Median/Mode',b:`<div class="formula">Mean=Sum/Count  Median=middle value\nWeighted avg=Î£(valÃ—wt)/Î£wt</div>`},
{c:'data',t:'Std Dev Intuition',b:`<div class="formula">More spreadâ†’higher SD  All sameâ†’SD=0\n+constantâ†’SD same  Ã—kâ†’SDÃ—|k|</div>`},
{c:'data',t:'Probability',b:`<div class="formula">P(Aâˆ©B)=P(A)Â·P(B) [indep]\nP(AâˆªB)=P(A)+P(B)âˆ’P(Aâˆ©B)\nP(at least 1)=1âˆ’P(none)</div>`},
{c:'data',t:'Combinations',b:`<div class="formula">nCr=n!/(r!(nâˆ’r)!)  Cancel before multiply\nnPr=n!/(nâˆ’r)!</div>`},
{c:'data',t:'Normal Distribution',b:`<div class="formula">68% within 1SD  95% within 2SD  99.7% within 3SD</div>`},
{c:'data',t:'Venn Diagrams',b:`<div class="formula">Total = A+Bâˆ’Both+Neither</div>`},
{c:'data',t:'Counting Principles',b:`<div class="formula">Fundamental: A ways Ã— B ways\nCircular: (nâˆ’1)!  With repetition: nÊ³</div>`},
{c:'strategy',t:'QC Strategy',b:`<div class="formula">Plug WEIRD #s: 0,1,âˆ’1,Â½,big\n2 different results â†’ D</div>`},
{c:'strategy',t:'Time Management',b:`<div class="formula">~1.75 min/Q. Easy<1min Med~1.5 Hard~2.5\nFlag & skip after 2.5 min</div>`},
{c:'strategy',t:'Estimation',b:`<div class="formula">If choices spreadâ†’rough math is enough\nCross-multiply to compare fractions</div>`},
{c:'strategy',t:'Process of Elimination',b:`<p>Eliminate wrong answers first. Even removing 1-2 helps odds dramatically.</p>`},
];
function renderSC(){
  const cats=['all','arithmetic','algebra','geometry','coordinate','data','strategy'];
  const labs=['All','Arithmetic','Algebra','Geometry','Coord Geo','Data','Strategy'];
  document.getElementById('scTabs').innerHTML=cats.map((c,i)=>`<button class="tab${i===0?' on':''}" onclick="fSC(this,'${c}')">${labs[i]}</button>`).join('');
  fSC(document.querySelector('#scTabs .tab.on'),'all');
}
function fSC(b,c){
  document.querySelectorAll('#scTabs .tab').forEach(x=>x.classList.remove('on'));b.classList.add('on');
  const col={arithmetic:['var(--accentD)','var(--accent)','ARITH'],algebra:['var(--ac2D)','var(--ac2)','ALGEBRA'],geometry:['var(--ac3D)','var(--ac3)','GEO'],coordinate:['var(--ac4D)','var(--ac4)','COORD'],data:['var(--ac5D)','var(--ac5)','DATA'],strategy:['rgba(200,200,200,.06)','var(--text2)','STRAT']};
  const f=c==='all'?SC:SC.filter(s=>s.c===c);
  document.getElementById('scGrid').innerHTML=f.map(s=>{const[bg,fg,lb]=col[s.c]||['','',''];return`<div class="sc"><div class="sc-h" onclick="this.nextElementSibling.classList.toggle('open');this.querySelector('.sc-arr').classList.toggle('open')"><h3><span class="badge" style="background:${bg};color:${fg}">${lb}</span>${s.t}</h3><span class="sc-arr">â–¸</span></div><div class="sc-b">${s.b}</div></div>`;}).join('');
}

// â•â•â•â•â•â•â• QUESTION GENERATORS â•â•â•â•â•â•â•
// Concept sub-categories for filtering
const CONCEPTS = {
  arithmetic: ['Remainders','Percentages','Divisibility','Exponents','Fractions','LCM/GCD','Ratios','Sequences','Absolute Value','Radicals'],
  algebra: ['Linear Equations','Quadratics','Inequalities','Systems','Functions','Exponents','Absolute Value','Word Problems','Sequences','Factoring'],
  geometry: ['Triangles','Circles','Rectangles','Cylinders','Angles','Special Triangles','Area','Pythagorean','Similar Figures','Polygons'],
  coordinate: ['Distance','Slope','Midpoint','Intercepts','Perpendicular','Area','Circle Eq','Reflections','Line Evaluation','Parallel Lines'],
  data: ['Mean/Median','Probability','Combinations','Std Deviation','Median','Venn Diagrams','Percentages','Bar Charts','Pie Charts','Line Charts']
};
const DIFFS = ['Easy','Medium','Hard'];

function genQ(cat, diff, concept) {
  const gens = {
    arithmetic:[gAR,gAP,gAD,gAE,gAF,gAL,gARa,gASq,gAAb,gARd],
    algebra:[gLL,gLQ,gLI,gLS,gLF,gLE,gLA,gLW,gLSq,gLFa],
    geometry:[gGT,gGC,gGR,gGCy,gGA,gGS,gGAr,gGP,gGSi,gGPo],
    coordinate:[gCD,gCS,gCM,gCI,gCP,gCA,gCC,gCR,gCL,gCPa],
    data:[gDM,gDP,gDC,gDS,gDMe,gDV,gDPe,gDCh1,gDCh2,gDCh3]
  };
  const fns = gens[cat] || gens.arithmetic;
  let idx = concept !== undefined ? concept : Ri(0, fns.length - 1);
  if (idx >= fns.length) idx = Ri(0, fns.length - 1);
  const q = fns[idx](diff || pick(DIFFS));
  q.concept = CONCEPTS[cat]?.[idx] || '';
  return q;
}

// Helper
function gcd(a,b){while(b){[a,b]=[b,a%b]}return a}
function wrongSet(ans,n=4,spread=null){
  const s=new Set([ans]);const sp=spread||[...Array(10)].map((_,i)=>i-5).filter(x=>x!==0);
  let tries=0;while(s.size<n&&tries<50){s.add(Math.round((ans+pick(sp))*100)/100);tries++;}
  return shuf([...s]);
}

// â•â•â• ARITHMETIC â•â•â•
function gAR(d){const b=pick([2,3,4,5,7,8,9]),m=pick([3,4,5,6,7,8,9,10,11]),e=Ri(10,50);let r=1;for(let i=0;i<e;i++)r=(r*b)%m;const o=wrongSet(r,4,[1,-1,2,-2,3]);return{cat:'arithmetic',type:'mc',diff:d,text:`What is the remainder when ${b}<sup>${e}</sup> is divided by ${m}?`,options:o.map(String),answer:o.indexOf(r),explanation:`Powers of ${b} mod ${m} cycle. Compute: 3Â¹â‰¡${b%m}, etc. Find cycle, then ${e} mod cycle_len â†’ position. Remainder=${r}.`,shortcut:'Cyclicity: find the repeating pattern of remainders, then use exponent mod cycle_length.'};}
function gAP(d){const p1=pick([10,15,20,25,30]),p2=pick([10,15,20,25,30]);const n=p1+(-p2)+(p1*(-p2))/100;const a=parseFloat(n.toFixed(1));const as=a>0?`+${a}%`:`${a}%`;const o=shuf([as,`${p1-p2>0?'+':''}${p1-p2}%`,`${-(p1-p2)>0?'+':''}${-(p1-p2)}%`,`${(a+2)>0?'+':''}${a+2}%`]);return{cat:'arithmetic',type:'mc',diff:d,text:`Price up ${p1}% then down ${p2}%. Net change?`,options:o,answer:o.indexOf(as),explanation:`Successive %: ${p1}+(âˆ’${p2})+(${p1})(âˆ’${p2})/100=${a}%.`,shortcut:'a+b+ab/100'};}
function gAD(d){const n=Ri(100,999)*Ri(2,9),dv=pick([3,4,6,7,8,9,11]);const yes=n%dv===0;return{cat:'arithmetic',type:'mc',diff:d,text:`Is ${n} divisible by ${dv}?`,options:['Yes','No'],answer:yes?0:1,explanation:`Apply divisibility rule for ${dv}. Answer: ${yes?'Yes':'No'}.`,shortcut:`Ã·${dv} rule: ${({3:'digit sumÃ·3',4:'last 2 digitsÃ·4',6:'Ã·2 AND Ã·3',7:'check directly',8:'last 3 digitsÃ·8',9:'digit sumÃ·9',11:'alternating sumÃ·11'})[dv]}`};}
function gAE(d){const b=pick([2,3,4,5]),e1=Ri(2,6),e2=Ri(2,6);const op=pick(['Ã—','Ã·']);let a;if(op==='Ã—')a=e1+e2;else{const big=Math.max(e1,e2),sm=Math.min(e1,e2);a=big-sm;}const o=wrongSet(a,4,[-2,-1,1,2]);return{cat:'arithmetic',type:'mc',diff:d,text:`${b}<sup>${op==='Ã—'?e1:Math.max(e1,e2)}</sup> ${op} ${b}<sup>${op==='Ã—'?e2:Math.min(e1,e2)}</sup> = ${b}<sup>?</sup>`,options:o.map(String),answer:o.indexOf(a),explanation:`${op==='Ã—'?'Add':'Subtract'} exponents: ${a}.`,shortcut:'Same base: multiplyâ†’add exp, divideâ†’subtract exp.'};}
function gAF(d){const fs=[[1,3],[2,3],[1,4],[3,4],[1,5],[2,5],[3,5],[1,6],[5,6],[1,8],[3,8],[5,8],[7,8]];const[n1,d1]=pick(fs),[n2,d2]=pick(fs);const op=pick(['+','âˆ’','Ã—']);let a;if(op==='+')a=n1/d1+n2/d2;else if(op==='âˆ’')a=Math.abs(n1/d1-n2/d2);else a=(n1/d1)*(n2/d2);a=Math.round(a*1000)/1000;const o=wrongSet(a,4,[-.25,-.1,.1,.25,.5]);return{cat:'arithmetic',type:'mc',diff:d,text:`${n1}/${d1} ${op} ${n2}/${d2} = ?`,options:o.map(String),answer:o.indexOf(a),explanation:`Convert to decimals: ${(n1/d1).toFixed(3)} ${op} ${(n2/d2).toFixed(3)} â‰ˆ ${a}`,shortcut:'Know fractionâ†”decimal conversions cold.'};}
function gAL(d){const a=Ri(4,30)*pick([2,3,5]),b=Ri(4,30)*pick([2,3,5]);const g=gcd(a,b),l=a*b/g;const isL=Math.random()<.5;const ans=isL?l:g;const o=wrongSet(ans,4,[-10,-5,5,10,20].map(x=>x*(ans>100?10:1)));return{cat:'arithmetic',type:'mc',diff:d,text:`What is the ${isL?'LCM':'GCD'} of ${a} and ${b}?`,options:o.filter(v=>v>0).slice(0,4).length>=4?o.filter(v=>v>0).slice(0,4):wrongSet(ans,4,[1,2,3,5]).filter(v=>v>0),get answer(){return this.options.map(String).indexOf(String(ans))},explanation:`${isL?'LCM':'GCD'}(${a},${b})=${ans}.`,shortcut:'LCM=aÃ—b/GCD. Find GCD first via Euclidean alg.'};}
function gARa(d){const r1=Ri(2,7),r2=Ri(2,7),t=Ri(3,12)*(r1+r2);const p1=t*r1/(r1+r2);const ans=Math.max(p1,t-p1);const o=wrongSet(ans,4,[-8,-4,4,8]);return{cat:'arithmetic',type:'mc',diff:d,text:`Ratio ${r1}:${r2}, sum=${t}. Larger quantity?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`Each part=${t/(r1+r2)}. Larger=${Math.max(r1,r2)}Ã—${t/(r1+r2)}=${ans}.`,shortcut:'Value = (part/total_parts) Ã— sum'};}
function gASq(d){const a1=Ri(1,20),dd=Ri(2,8),n=Ri(8,20);const an=a1+(n-1)*dd,sum=n*(a1+an)/2;const isS=Math.random()<.5;const ans=isS?sum:an;const o=wrongSet(ans,4,[-dd*2,-dd,dd,dd*2]);return{cat:'arithmetic',type:'mc',diff:d,text:`Arith seq: aâ‚=${a1}, d=${dd}. ${isS?`Sum of first ${n} terms`:`${n}th term`}?`,options:o.map(String),get answer(){return this.options.indexOf(String(ans))},explanation:isS?`aâ‚™=${an}, Sum=${n}(${a1}+${an})/2=${sum}.`:`aâ‚™=${a1}+(${n-1})Â·${dd}=${an}.`,shortcut:isS?'Sum=n(first+last)/2':'aâ‚™=aâ‚+(nâˆ’1)d'};}
function gAAb(d){const a=Ri(2,10),b=Ri(1,20);const s1=(-b+a),s2=(-b-a);const ans=s1+s2;const o=wrongSet(ans,4,[-4,-2,2,4]);return{cat:'arithmetic',type:'mc',diff:d,text:`If |x+${b}|=${a}, sum of all values of x?`,options:o.map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`x=${s1} or x=${s2}. Sum=${ans}.`,shortcut:'Sum of solutions of |x+b|=a is always âˆ’2b.'};}
function gARd(d){const n=pick([2,3,5,6,7,8,10,12,18,20,27,32,45,48,50,72,75,98,128,200]);let out=1,ins=n;for(let p of[2,3,5,7])while(ins%(p*p)===0){ins/=p*p;out*=p;}const as=ins===1?`${out}`:`${out===1?'':out}âˆš${ins}`;const o=shuf([as,`${out+1}âˆš${ins>1?ins:2}`,`${Math.max(1,out-1)}âˆš${ins+1}`,`âˆš${n}`]).slice(0,4);if(!o.includes(as))o[3]=as;return{cat:'arithmetic',type:'mc',diff:d,text:`Simplify âˆš${n}`,options:o,get answer(){return this.options.indexOf(as)},explanation:`âˆš${n}=${as}.`,shortcut:'Factor out largest perfect square.'};}

// â•â•â• ALGEBRA â•â•â•
function gLL(d){const a=Ri(2,8),b=Ri(-15,15),x=Ri(-10,10),c=a*x+b;const o=wrongSet(x,4,[-3,-2,-1,1,2,3]);return{cat:'algebra',type:'mc',diff:d,text:`${a}x ${b>=0?'+ '+b:'âˆ’ '+Math.abs(b)} = ${c}. x = ?`,options:o.map(String),answer:o.indexOf(x),explanation:`${a}x=${c-b}, x=${x}.`,shortcut:'Isolate x in one step.'};}
function gLQ(d){const r1=Ri(-8,8),r2=Ri(-8,8);const b=-(r1+r2),c=r1*r2;const ans=Math.max(r1,r2);const o=wrongSet(ans,4,[-3,-1,1,3]);return{cat:'algebra',type:'mc',diff:d,text:`xÂ²${b>=0?'+'+b:'âˆ’'+Math.abs(b)}x${c>=0?'+'+c:'âˆ’'+Math.abs(c)}=0. Greater root?`,options:o.map(String),answer:o.indexOf(ans),explanation:`(xâˆ’${r1})(xâˆ’${r2})=0. Roots: ${r1},${r2}. Greater=${ans}.`,shortcut:'Factor pairs of c that sum to b.'};}
function gLI(d){const a=Ri(2,6),b=Ri(1,20),c=Ri(b+a*2,b+a*12);const bound=(c-b)/a;const cnt=Math.max(0,Math.floor(bound)+1);const o=wrongSet(cnt,4,[-2,-1,1,2]);return{cat:'algebra',type:'mc',diff:d,text:`How many non-negative integers satisfy ${a}x+${b} â‰¤ ${c}?`,options:o.filter(v=>v>=0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(cnt))},explanation:`xâ‰¤${bound.toFixed(2)}. Count: 0,1,...,${Math.floor(bound)} = ${cnt}.`,shortcut:'Solve for x, count integers in range.'};}
function gLS(d){const x=Ri(-8,8),y=Ri(-8,8),a1=Ri(1,5),b1=Ri(1,5),c1=a1*x+b1*y,a2=Ri(1,5),b2=Ri(1,5),c2=a2*x+b2*y;if(a1*b2===a2*b1)return gLS(d);const tgt=pick(['x','y','x+y','xy']);let ans;switch(tgt){case'x':ans=x;break;case'y':ans=y;break;case'x+y':ans=x+y;break;case'xy':ans=x*y;break}const o=wrongSet(ans);return{cat:'algebra',type:'mc',diff:d,text:`${a1}x+${b1}y=${c1}, ${a2}x+${b2}y=${c2}. ${tgt}=?`,options:o.map(String),answer:o.indexOf(ans),explanation:`Solving: x=${x},y=${y}. ${tgt}=${ans}.`,shortcut:'Add/subtract equations for combined expressions.'};}
function gLF(d){const a=Ri(1,4),b=Ri(-8,8),x=Ri(-5,5);const fx=a*x+b,ffx=a*fx+b;const o=wrongSet(ffx);return{cat:'algebra',type:'mc',diff:d,text:`f(x)=${a}x${b>=0?'+'+b:b}. f(f(${x}))=?`,options:o.map(String),answer:o.indexOf(ffx),explanation:`f(${x})=${fx}. f(${fx})=${ffx}.`,shortcut:'Work inside-out.'};}
function gLE(d){const base=pick([2,3,5]),x=Ri(2,8),y=Ri(1,x-1);const s=x+y,prod=base**s;const o=wrongSet(x,4,[-2,-1,1,2]);return{cat:'algebra',type:'mc',diff:d,text:`${base}^xÂ·${base}^y=${prod}, xâˆ’y=${x-y}. x=?`,options:o.map(String),answer:o.indexOf(x),explanation:`x+y=${s}, xâˆ’y=${x-y}. 2x=${s+x-y}. x=${x}.`,shortcut:'Same baseâ†’equate exp. Combine with 2nd equation.'};}
function gLA(d){const a=Ri(2,5),b=Ri(1,15),k=Ri(1,10);const s1=(k-b)/a,s2=(-k-b)/a;const sum=Math.round((s1+s2)*100)/100;return{cat:'algebra',type:'numeric',diff:d,text:`|${a}x+${b}|=${k}. Sum of all x values? (decimal ok)`,answer:sum,explanation:`x=${s1.toFixed(2)} or ${s2.toFixed(2)}. Sum=${sum}.`,shortcut:'Sum = âˆ’2b/a.'};}
function gLW(d){const r1=Ri(2,8),r2=Ri(2,8);if(r1===r2)return gLW(d);const t=Ri(50,200);const h=Math.round(t/(r1+r2)*10)/10;const o=wrongSet(h,4,[-2,-1,1,2,3]);return{cat:'algebra',type:'mc',diff:d,text:`Machine A: ${r1}/hr, B: ${r2}/hr. Together, hours for ${t} items?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(h))},explanation:`Combined=${r1+r2}/hr. Time=${t}/${r1+r2}=${h}h.`,shortcut:'Add rates. Time=Total/CombinedRate.'};}
function gLSq(d){const a=Ri(1,5),r=pick([2,3,-2,-1,0.5]);const n=Ri(4,7);const v=Math.round(a*r**(n-1)*1000)/1000;const o=wrongSet(v);return{cat:'algebra',type:'mc',diff:d,text:`Geo seq: aâ‚=${a}, r=${r}. ${n}th term?`,options:o.map(String),answer:o.indexOf(v),explanation:`aâ‚™=${a}Â·${r}^${n-1}=${v}.`,shortcut:'aâ‚™=aâ‚Â·râ¿â»Â¹'};}
function gLFa(d){const b=Ri(1,10);const o=shuf([`(xâˆ’${b})(x+${b})`,`(xâˆ’${b})Â²`,`(x+${b})Â²`,`(xâˆ’${b*2})(x+1)`]);return{cat:'algebra',type:'mc',diff:d,text:`Factor: xÂ²âˆ’${b*b}`,options:o,answer:o.indexOf(`(xâˆ’${b})(x+${b})`),explanation:`Difference of squares: xÂ²âˆ’${b}Â²=(xâˆ’${b})(x+${b}).`,shortcut:'aÂ²âˆ’bÂ²=(aâˆ’b)(a+b)'};}

// â•â•â• GEOMETRY â•â•â•
function gGT(d){const a=Ri(3,12),b=Ri(3,12);const ar=a*b/2;const o=wrongSet(ar);return{cat:'geometry',type:'mc',diff:d,text:`Right triangle legs ${a} and ${b}. Area?`,options:o.map(String),answer:o.indexOf(ar),explanation:`Â½Â·${a}Â·${b}=${ar}.`,shortcut:'Right â–³ area: Â½Â·legâ‚Â·legâ‚‚'};}
function gGC(d){const r=Ri(2,12),th=pick([30,45,60,72,90,120,180]);const isA=Math.random()<.5;const ans=Math.round((isA?th/360*2*Math.PI*r:th/360*Math.PI*r*r)*100)/100;const o=wrongSet(ans,4,[-5,-2,2,5].map(x=>x*(ans>50?10:1)));return{cat:'geometry',type:'mc',diff:d,text:`Circle r=${r}. ${isA?'Arc length':'Sector area'} for ${th}Â°? (Ï€â‰ˆ3.14)`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`(${th}/360)Ã—${isA?`2Ï€(${r})`:`Ï€(${r})Â²`}=${ans}.`,shortcut:'Î¸/360 Ã— (circumference or area)'};}
function gGR(d){const l=Ri(3,20),w=Ri(3,20);const dg=Math.round(Math.sqrt(l*l+w*w)*100)/100;const o=wrongSet(dg,4,[-2,-1,1,2]);return{cat:'geometry',type:'mc',diff:d,text:`Rectangle ${l}Ã—${w}. Diagonal?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(dg))},explanation:`âˆš(${l}Â²+${w}Â²)=âˆš${l*l+w*w}â‰ˆ${dg}.`,shortcut:'Diagonal=âˆš(lÂ²+wÂ²)'};}
function gGCy(d){const r=Ri(2,8),h=Ri(4,15);const isV=Math.random()<.5;const ans=Math.round((isV?Math.PI*r*r*h:2*Math.PI*r*r+2*Math.PI*r*h)*100)/100;const o=wrongSet(ans,4,[-50,-20,20,50]);return{cat:'geometry',type:'mc',diff:d,text:`Cylinder r=${r},h=${h}. ${isV?'Volume':'Surface area'}? (Ï€â‰ˆ3.14)`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`${isV?'Ï€rÂ²h':'2Ï€r(r+h)'}=${ans}.`,shortcut:isV?'V=Ï€rÂ²h':'SA=2Ï€r(r+h)'};}
function gGA(d){const n=pick([5,6,8,9,10,12]);const s=(n-2)*180;const e=s/n;const isS=Math.random()<.5;const ans=isS?s:e;const nm={5:'pentagon',6:'hexagon',8:'octagon',9:'nonagon',10:'decagon',12:'dodecagon'};const o=wrongSet(ans,4,[-40,-20,20,40]);return{cat:'geometry',type:'mc',diff:d,text:`${isS?'Sum of angles':'Each angle'} of regular ${nm[n]}?`,options:o.filter(v=>v>0).slice(0,4).map(v=>v+'Â°'),get answer(){return this.options.indexOf(ans+'Â°')},explanation:`Sum=(${n}âˆ’2)Ã—180=${s}Â°. Each=${e}Â°.`,shortcut:'(nâˆ’2)Ã—180 for sum. Ã·n for each.'};}
function gGS(d){const tp=pick(['30-60-90','45-45-90']);const x=Ri(2,10);let q,ans;if(tp==='30-60-90'){const h=2*x;q=`30-60-90: shortest side=${x}. Hypotenuse?`;ans=h;}else{ans=Math.round(x*1.414*100)/100;q=`45-45-90: each leg=${x}. Hypotenuse?`;}const o=wrongSet(ans,4,[-2,-1,1,2,3]);return{cat:'geometry',type:'mc',diff:d,text:q,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`${tp}: ${tp==='30-60-90'?'x:xâˆš3:2x':'x:x:xâˆš2'}.`,shortcut:'Memorize special triangle ratios.'};}
function gGAr(d){const b1=Ri(4,15),b2=Ri(4,15),h=Ri(3,10);const a=(b1+b2)*h/2;const o=wrongSet(a,4,[-10,-5,5,10]);return{cat:'geometry',type:'mc',diff:d,text:`Trapezoid: parallel sides ${b1},${b2}; height ${h}. Area?`,options:o.map(String),answer:o.indexOf(a),explanation:`Â½(${b1}+${b2})Â·${h}=${a}.`,shortcut:'Â½(bâ‚+bâ‚‚)h'};}
function gGP(d){const ts=[[3,4,5],[5,12,13],[8,15,17],[7,24,25]];const[a,b,c]=pick(ts);const k=Ri(1,4);const ss=[a*k,b*k,c*k];const mi=Ri(0,2);const ans=ss[mi];const sh=ss.filter((_,i)=>i!==mi);const o=wrongSet(ans,4,[-3,-1,1,3,5]);return{cat:'geometry',type:'mc',diff:d,text:`Right â–³: ${mi===2?`legs ${sh[0]},${sh[1]}`:`leg ${sh[0]}, hyp ${sh[1]}`}. Find ${mi===2?'hypotenuse':'other leg'}.`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`Pythagorean: ${ans}.`,shortcut:'Know triples: 3-4-5, 5-12-13, 8-15-17 + multiples.'};}
function gGSi(d){const k=pick([2,3,4,5]);const a1=Ri(10,50);const o=wrongSet(k*k,4,[-3,-1,1,3]);return{cat:'geometry',type:'mc',diff:d,text:`Similar â–³s, sides ratio 1:${k}. Area ratio?`,options:o.filter(v=>v>0).slice(0,4).map(v=>`1:${v}`),get answer(){return this.options.indexOf(`1:${k*k}`)},explanation:`Sides k â†’ areas kÂ². 1:${k*k}.`,shortcut:'Side ratio k â†’ area ratio kÂ².'};}
function gGPo(d){const n=pick([3,4,5,6,8,10]);const ext=360/n;const o=wrongSet(ext,4,[-20,-10,10,20]);return{cat:'geometry',type:'mc',diff:d,text:`Each exterior angle of regular ${n}-gon?`,options:o.filter(v=>v>0).slice(0,4).map(v=>v+'Â°'),get answer(){return this.options.indexOf(ext+'Â°')},explanation:`360/${n}=${ext}Â°.`,shortcut:'Exterior angles sum to 360Â°.'};}

// â•â•â• COORDINATE â•â•â•
function gCD(d){const x1=Ri(-8,8),y1=Ri(-8,8),x2=Ri(-8,8),y2=Ri(-8,8);const ds=Math.round(Math.sqrt((x2-x1)**2+(y2-y1)**2)*100)/100;const o=wrongSet(ds,4,[-2,-1,1,2]);return{cat:'coordinate',type:'mc',diff:d,text:`Distance: (${x1},${y1}) to (${x2},${y2})?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ds))},explanation:`âˆš(${(x2-x1)**2}+${(y2-y1)**2})â‰ˆ${ds}.`,shortcut:'Distance formula. Look for Pythagorean triples.'};}
function gCS(d){let x1=Ri(-8,8),y1=Ri(-8,8),x2=Ri(-8,8),y2=Ri(-8,8);if(x1===x2)x2++;const sl=Math.round((y2-y1)/(x2-x1)*100)/100;const o=wrongSet(sl,4,[-2,-1,.5,1,2]);return{cat:'coordinate',type:'mc',diff:d,text:`Slope through (${x1},${y1}) and (${x2},${y2})?`,options:o.map(String),answer:o.indexOf(sl),explanation:`(${y2}âˆ’${y1})/(${x2}âˆ’${x1})=${sl}.`,shortcut:'Rise/run.'};}
function gCM(d){const x1=Ri(-10,10),y1=Ri(-10,10),x2=Ri(-10,10),y2=Ri(-10,10);const mx=(x1+x2)/2,my=(y1+y2)/2;const ans=`(${mx}, ${my})`;const o=shuf([ans,`(${mx+1}, ${my})`,`(${mx}, ${my+1})`,`(${mx-1}, ${my-1})`]);return{cat:'coordinate',type:'mc',diff:d,text:`Midpoint of (${x1},${y1}) and (${x2},${y2})?`,options:o,answer:o.indexOf(ans),explanation:`((${x1}+${x2})/2,(${y1}+${y2})/2)=(${mx},${my}).`,shortcut:'Average x, average y.'};}
function gCI(d){const a=Ri(1,6),b=Ri(1,6),c=Ri(6,36);const xi=Math.round(c/a*100)/100,yi=Math.round(c/b*100)/100;const ar=Math.round(.5*xi*yi*100)/100;const o=wrongSet(ar,4,[-5,-2,2,5]);return{cat:'coordinate',type:'mc',diff:d,text:`${a}x+${b}y=${c} forms triangle with axes. Area?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ar))},explanation:`x-int=${xi}, y-int=${yi}. Area=Â½Â·${xi}Â·${yi}=${ar}.`,shortcut:'CÂ²/(2AB) or find intercepts manually.'};}
function gCP(d){const m=pick([1,2,3,4,-1,-2,-3]);const px=Ri(-5,5),py=Ri(-5,5);const pm=-1/m;const yi2=Math.round((py-pm*px)*100)/100;const xx=Math.round(-yi2/pm*100)/100;const ans=`(${xx}, 0)`;const o=shuf([ans,`(${Math.round(xx+2)}, 0)`,`(0, ${Math.round(yi2)})`,`(${Math.round(-xx)}, 0)`]);return{cat:'coordinate',type:'mc',diff:d,text:`Line through (${px},${py}), âŠ¥ to y=${m}x+1. x-intercept?`,options:o,answer:o.indexOf(ans),explanation:`Perp slope=${pm.toFixed(3)}. Lineâ†’set y=0â†’x=${xx}.`,shortcut:'Perp slope = âˆ’1/m. Point-slope form.'};}
function gCA(d){const x2=Ri(3,10),x3=Ri(1,9),y3=Ri(2,8);const ar=Math.abs(x2*y3)/2;const o=wrongSet(ar,4,[-4,-2,2,4]);return{cat:'coordinate',type:'mc',diff:d,text:`Triangle: (0,0),(${x2},0),(${x3},${y3}). Area?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ar))},explanation:`Base=${x2}, height=${y3}. Â½Â·${x2}Â·${y3}=${ar}.`,shortcut:'Base on axisâ†’Â½Â·baseÂ·height.'};}
function gCC(d){const h=Ri(-5,5),k=Ri(-5,5),r=Ri(2,8);const ans=`(${h}, ${k})`;const o=shuf([ans,`(${-h}, ${-k})`,`(${h}, ${-k})`,`(${-h}, ${k})`]);return{cat:'coordinate',type:'mc',diff:d,text:`Center of (x${h>=0?'âˆ’'+h:'+'+Math.abs(h)})Â²+(y${k>=0?'âˆ’'+k:'+'+Math.abs(k)})Â²=${r*r}?`,options:o,answer:o.indexOf(ans),explanation:`(xâˆ’h)Â²+(yâˆ’k)Â²=rÂ²â†’center(${h},${k}).`,shortcut:'Watch signs in (xâˆ’h)Â²+(yâˆ’k)Â².'};}
function gCR(d){const x=Ri(-8,8),y=Ri(-8,8);const ax=pick(['x-axis','y-axis','origin','y=x']);let rx,ry;switch(ax){case'x-axis':rx=x;ry=-y;break;case'y-axis':rx=-x;ry=y;break;case'origin':rx=-x;ry=-y;break;case'y=x':rx=y;ry=x;break}const ans=`(${rx}, ${ry})`;const o=shuf([`(${rx}, ${ry})`,`(${-rx}, ${ry})`,`(${rx}, ${-ry})`,`(${ry}, ${rx})`]);return{cat:'coordinate',type:'mc',diff:d,text:`Reflect (${x},${y}) over ${ax}.`,options:o,answer:o.indexOf(ans),explanation:`${ax}: (${x},${y})â†’(${rx},${ry}).`,shortcut:'x-axis:flip y. y-axis:flip x. Origin:both. y=x:swap.'};}
function gCL(d){const m=pick([-3,-2,-1,1,2,3,4]),b=Ri(-10,10),x=Ri(-5,5);return{cat:'coordinate',type:'numeric',diff:d,text:`y=${m}x${b>=0?'+'+b:b}. y when x=${x}?`,answer:m*x+b,explanation:`${m}(${x})${b>=0?'+'+b:b}=${m*x+b}.`,shortcut:'Direct substitution.'};}
function gCPa(d){const m=pick([1,2,3,-1,-2,-3,.5,-.5]);const o=shuf([m,-1/m,-m,m+1].map(String));return{cat:'coordinate',type:'mc',diff:d,text:`Slope=${m}. Parallel line's slope?`,options:o,answer:o.indexOf(String(m)),explanation:`Parallel=same slope=${m}.`,shortcut:'Parallel=same slope. Perp=neg reciprocal.'};}

// â•â•â• DATA â•â•â•
function gDM(d){const n=Ri(5,9),vs=Array.from({length:n},()=>Ri(10,100));const s=vs.reduce((a,b)=>a+b,0);const nv=Ri(10,100);const nm=Math.round((s+nv)/(n+1)*100)/100;const o=wrongSet(nm,4,[-5,-2,2,5]);return{cat:'data',type:'mc',diff:d,text:`Mean of {${vs.join(',')}} is ${(s/n).toFixed(1)}. Add ${nv}. New mean?`,options:o.map(String),answer:o.indexOf(nm),explanation:`New sum=${s+nv}. New mean=${s+nv}/${n+1}=${nm}.`,shortcut:'Mean=Sum/Count.'};}
function gDP(d){const r=Ri(2,8),b=Ri(2,8),t=r+b;const p=Math.round(r*(r-1)/(t*(t-1))*10000)/10000;const o=wrongSet(p,4,[-.05,.05,.1,-.1]);return{cat:'data',type:'mc',diff:d,text:`${r} red, ${b} blue marbles. P(both red, no replacement)?`,options:o.filter(v=>v>0&&v<1).slice(0,4).map(v=>(v*100).toFixed(2)+'%'),get answer(){return this.options.indexOf((p*100).toFixed(2)+'%')},explanation:`(${r}/${t})Â·(${r-1}/${t-1})=${(p*100).toFixed(2)}%.`,shortcut:'Without replacement: reduce counts.'};}
function gDC(d){const n=Ri(5,12),r=Ri(2,Math.min(n-1,5));function f(x){let v=1;for(let i=2;i<=x;i++)v*=i;return v}const ans=f(n)/(f(r)*f(n-r));const o=wrongSet(ans,4,[-20,-10,10,20]);return{cat:'data',type:'mc',diff:d,text:`${n}C${r} = ?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`${n}!/(${r}!Â·${n-r}!)=${ans}.`,shortcut:'Cancel before multiplying.'};}
function gDS(d){const base=Ri(10,50),sp=Ri(1,5);const sA=Array.from({length:5},()=>base+Ri(-sp,sp)),sB=Array.from({length:5},()=>base+Ri(-sp*3,sp*3));return{cat:'data',type:'mc',diff:d,text:`A:{${sA.join(',')}} B:{${sB.join(',')}}. Which has higher SD?`,options:['Set A','Set B','Equal','Cannot tell'],answer:1,explanation:`B is more spread out â†’ higher SD.`,shortcut:"Don't calculate SD. Eyeball the spread."};}
function gDMe(d){const vs=Array.from({length:7},()=>Ri(5,50)).sort((a,b)=>a-b);const med=vs[3];const o=wrongSet(med,4,[-3,-1,1,3]);return{cat:'data',type:'mc',diff:d,text:`Median of {${shuf(vs).join(',')}}?`,options:o.map(String),answer:o.indexOf(med),explanation:`Sorted:{${vs.join(',')}}. Middle=${med}.`,shortcut:'Sort, pick middle.'};}
function gDV(d){const t=Ri(60,150),a=Ri(20,t-20),b=Ri(20,t-20),bo=Ri(5,Math.min(a,b)-5);const ne=t-a-b+bo;if(ne<0)return gDV(d);const o=wrongSet(ne,4,[-8,-4,4,8]);return{cat:'data',type:'mc',diff:d,text:`${t} people: ${a} tea, ${b} coffee, ${bo} both. Neither?`,options:o.filter(v=>v>=0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ne))},explanation:`Totalâˆ’(A+Bâˆ’Both)=${t}âˆ’${a+b-bo}=${ne}.`,shortcut:'Total=A+Bâˆ’Both+Neither.'};}
function gDPe(d){const t=Ri(200,500),ps=[];let rem=100;for(let i=0;i<4;i++){const p=Ri(10,Math.floor(rem/((4-i))));ps.push(p);rem-=p;}ps.push(rem);const idx=Ri(0,4);const ans=Math.round(t*ps[idx]/100);const o=wrongSet(ans,4,[-15,-8,8,15]);const labels=['A','B','C','D','E'];return{cat:'data',type:'mc',diff:d,text:`${t} surveyed: ${ps.map((p,i)=>`${labels[i]}:${p}%`).join(', ')}. How many chose ${labels[idx]}?`,options:o.filter(v=>v>0).slice(0,4).map(String),get answer(){return this.options.indexOf(String(ans))},explanation:`${ps[idx]}% of ${t}=${ans}.`,shortcut:'Total Ã— decimal.'};}

// Chart questions
function gDCh1(d){const months=['Jan','Feb','Mar','Apr','May','Jun'];const sales=months.map(()=>Ri(20,100)*10);const idx=Ri(0,5);const ans=sales[idx];const cid='c'+Date.now()+Ri(0,9999);const o=wrongSet(ans,4,[-100,-50,50,100]);return{cat:'data',type:'mc',diff:d,text:`<div class="chart-title">Monthly Sales ($K)</div><canvas id="${cid}" width="480" height="200"></canvas><br>Sales in ${months[idx]}?`,options:o.filter(v=>v>0).slice(0,4).map(v=>'$'+v+'K'),get answer(){return this.options.indexOf('$'+ans+'K')},explanation:`Bar chart shows ${months[idx]}=$${ans}K.`,shortcut:'Read y-axis carefully.',isChart:true,chartFn:()=>drawBar(cid,months,sales)};}
function gDCh2(d){const cats=['Tech','Health','Finance','Energy','Retail'];const vs=cats.map(()=>Ri(5,40));const tot=vs.reduce((a,b)=>a+b,0);const pcts=vs.map(v=>Math.round(v/tot*100));const idx=Ri(0,4);const ans=pcts[idx];const o=wrongSet(ans,4,[-8,-4,4,8]);const cid='c'+Date.now()+Ri(0,9999);return{cat:'data',type:'mc',diff:d,text:`<div class="chart-title">Portfolio Allocation</div><canvas id="${cid}" width="380" height="230"></canvas><br>~% in ${cats[idx]}?`,options:o.filter(v=>v>0&&v<=100).slice(0,4).map(v=>v+'%'),get answer(){return this.options.indexOf(ans+'%')},explanation:`${cats[idx]}â‰ˆ${ans}%.`,shortcut:'Estimate slice vs quarter (25%).',isChart:true,chartFn:()=>drawPie(cid,cats,pcts)};}
function gDCh3(d){const yrs=['2019','2020','2021','2022','2023'];const cA=yrs.map(()=>Ri(30,90)),cB=yrs.map(()=>Ri(30,90));const yi=Ri(0,4);const diff=Math.abs(cA[yi]-cB[yi]);const o=wrongSet(diff,4,[-10,-5,5,10]);const cid='c'+Date.now()+Ri(0,9999);return{cat:'data',type:'mc',diff:d,text:`<div class="chart-title">Revenue ($M): A vs B</div><canvas id="${cid}" width="480" height="200"></canvas><br>Abs difference in ${yrs[yi]}?`,options:o.filter(v=>v>=0).slice(0,4).map(v=>'$'+v+'M'),get answer(){return this.options.indexOf('$'+diff+'M')},explanation:`A=$${cA[yi]}M, B=$${cB[yi]}M. Diff=$${diff}M.`,shortcut:'Read both lines at year, subtract.',isChart:true,chartFn:()=>drawLine(cid,yrs,cA,cB)};}

// â•â•â• CHART DRAW â•â•â•
function drawBar(id,labels,data){setTimeout(()=>{const cv=document.getElementById(id);if(!cv)return;const x=cv.getContext('2d'),w=cv.width,h=cv.height,p={l:45,r:15,t:15,b:35};const mx=Math.max(...data)*1.2,bw=(w-p.l-p.r)/labels.length*.6,gp=(w-p.l-p.r)/labels.length*.4;const tc=getComputedStyle(document.documentElement).getPropertyValue('--text2').trim(),lc=getComputedStyle(document.documentElement).getPropertyValue('--border').trim(),ac=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();x.clearRect(0,0,w,h);x.strokeStyle=lc;x.lineWidth=.5;x.font='9px JetBrains Mono';x.fillStyle=tc;x.textAlign='right';for(let i=0;i<=4;i++){const y=p.t+(h-p.t-p.b)*(1-i/4);x.beginPath();x.moveTo(p.l,y);x.lineTo(w-p.r,y);x.stroke();x.fillText(Math.round(mx*i/4),p.l-4,y+3)}x.textAlign='center';labels.forEach((l,i)=>{const lx=p.l+i*(bw+gp)+gp/2,bh=data[i]/mx*(h-p.t-p.b),y=h-p.b-bh;const g=x.createLinearGradient(0,y,0,h-p.b);g.addColorStop(0,ac);g.addColorStop(1,'rgba(0,229,160,.3)');x.fillStyle=g;x.beginPath();x.roundRect(lx,y,bw,bh,3);x.fill();x.fillStyle=tc;x.font='9px DM Sans';x.fillText(l,lx+bw/2,h-p.b+14)})},60)}
function drawPie(id,labels,pcts){setTimeout(()=>{const cv=document.getElementById(id);if(!cv)return;const x=cv.getContext('2d'),w=cv.width,h=cv.height,cx=w*.35,cy=h/2,r=Math.min(w*.28,h*.38);const cs=['#00e5a0','#7c5cfc','#ff6b6b','#ffd93d','#00b4ff'];const tc=getComputedStyle(document.documentElement).getPropertyValue('--text').trim();x.clearRect(0,0,w,h);let sa=-Math.PI/2;pcts.forEach((p,i)=>{const sl=p/100*2*Math.PI;x.beginPath();x.moveTo(cx,cy);x.arc(cx,cy,r,sa,sa+sl);x.closePath();x.fillStyle=cs[i%5];x.fill();x.strokeStyle='rgba(0,0,0,.2)';x.lineWidth=1;x.stroke();sa+=sl});x.font='10px DM Sans';x.textAlign='left';labels.forEach((l,i)=>{const ly=24+i*20,lx=w*.66;x.fillStyle=cs[i%5];x.fillRect(lx,ly-7,10,10);x.fillStyle=tc;x.fillText(`${l} ${pcts[i]}%`,lx+15,ly+2)})},60)}
function drawLine(id,labels,dA,dB){setTimeout(()=>{const cv=document.getElementById(id);if(!cv)return;const x=cv.getContext('2d'),w=cv.width,h=cv.height,p={l:45,r:15,t:15,b:35};const mx=Math.max(...dA,...dB)*1.2;const tc=getComputedStyle(document.documentElement).getPropertyValue('--text2').trim(),lc=getComputedStyle(document.documentElement).getPropertyValue('--border').trim();x.clearRect(0,0,w,h);x.strokeStyle=lc;x.lineWidth=.5;x.font='9px JetBrains Mono';x.fillStyle=tc;x.textAlign='right';for(let i=0;i<=4;i++){const y=p.t+(h-p.t-p.b)*(1-i/4);x.beginPath();x.moveTo(p.l,y);x.lineTo(w-p.r,y);x.stroke();x.fillText(Math.round(mx*i/4),p.l-4,y+3)}x.textAlign='center';labels.forEach((l,i)=>{x.fillText(l,p.l+i/(labels.length-1)*(w-p.l-p.r),h-p.b+14)});function dl(d,c){x.strokeStyle=c;x.lineWidth=2;x.lineJoin='round';x.beginPath();d.forEach((v,i)=>{const px=p.l+i/(d.length-1)*(w-p.l-p.r),py=p.t+(1-v/mx)*(h-p.t-p.b);i===0?x.moveTo(px,py):x.lineTo(px,py)});x.stroke();d.forEach((v,i)=>{const px=p.l+i/(d.length-1)*(w-p.l-p.r),py=p.t+(1-v/mx)*(h-p.t-p.b);x.beginPath();x.arc(px,py,3,0,Math.PI*2);x.fillStyle=c;x.fill()})}dl(dA,'#00e5a0');dl(dB,'#7c5cfc');x.font='10px DM Sans';x.textAlign='left';x.fillStyle='#00e5a0';x.fillRect(w-100,8,12,3);x.fillStyle=tc;x.fillText('A',w-84,12);x.fillStyle='#7c5cfc';x.fillRect(w-100,20,12,3);x.fillStyle=tc;x.fillText('B',w-84,24)},60)}

// â•â•â• PRACTICE SYSTEM â•â•â•
let prInit=false,prCat='all',prDiff='all',prConcept='all',prQ=[],prIdx=0,prSel=null,prAns=false,prT0=0;

function initPR(){
  prInit=true;
  const cats=['all','arithmetic','algebra','geometry','coordinate','data'];
  const labs=['All','Arithmetic','Algebra','Geometry','Coord. Geo','Data'];
  document.getElementById('prTopicTabs').innerHTML=cats.map((c,i)=>`<button class="tab${i===0?' on':''}" onclick="setPrCat(this,'${c}')">${labs[i]}</button>`).join('');
  const diffs=['all','Easy','Medium','Hard'];
  document.getElementById('prDiffTabs').innerHTML=diffs.map((d,i)=>`<button class="tab${i===0?' on':''}" onclick="setPrDiff(this,'${d}')">${d==='all'?'All':d}</button>`).join('');
  updateConceptChips();
  loadBatch();
}

function setPrCat(b,c){document.querySelectorAll('#prTopicTabs .tab').forEach(x=>x.classList.remove('on'));b.classList.add('on');prCat=c;prConcept='all';updateConceptChips();prQ=[];prIdx=0;loadBatch();}
function setPrDiff(b,d){document.querySelectorAll('#prDiffTabs .tab').forEach(x=>x.classList.remove('on'));b.classList.add('on');prDiff=d;prQ=[];prIdx=0;loadBatch();}
function setPrConcept(b,c){document.querySelectorAll('#prConcepts .chip').forEach(x=>x.classList.remove('on'));b.classList.add('on');prConcept=c;prQ=[];prIdx=0;loadBatch();}

function updateConceptChips(){
  if(prCat==='all'){document.getElementById('prConcepts').innerHTML='<span class="chip on" onclick="setPrConcept(this,\'all\')">All Concepts</span>';return;}
  const cs=CONCEPTS[prCat]||[];
  document.getElementById('prConcepts').innerHTML='<span class="chip on" onclick="setPrConcept(this,\'all\')">All</span>'+cs.map((c,i)=>`<span class="chip" onclick="setPrConcept(this,${i})">${c}</span>`).join('');
}

function loadBatch(){
  const cats=prCat==='all'?['arithmetic','algebra','geometry','coordinate','data']:[prCat];
  for(let i=0;i<10;i++){
    const cat=pick(cats);
    const diff=prDiff==='all'?pick(DIFFS):prDiff;
    const concept=prConcept==='all'?undefined:prConcept;
    prQ.push(genQ(cat,diff,concept));
  }
  renderQ();
}

function renderQ(){
  if(prIdx>=prQ.length){loadBatch();return;}
  const q=prQ[prIdx];prSel=null;prAns=false;prT0=Date.now();
  document.getElementById('qCtr').textContent=`Q ${prIdx+1} / ${prQ.length}+`;
  document.getElementById('prFill').style.width=((prIdx+1)/Math.max(prQ.length,1)*100)+'%';
  const col={arithmetic:['var(--accentD)','var(--accent)','ARITH'],algebra:['var(--ac2D)','var(--ac2)','ALGEBRA'],geometry:['var(--ac3D)','var(--ac3)','GEO'],coordinate:['var(--ac4D)','var(--ac4)','COORD'],data:['var(--ac5D)','var(--ac5)','DATA']};
  const[bg,fg,lb]=col[q.cat]||['','',''];
  const tl={mc:'Multiple Choice',qc:'Qty Comparison',numeric:'Numeric Entry'};
  let body='';
  if(q.type==='qc'&&q.qA)body+=`<div class="qc-box"><div class="qc-col"><h4>Qty A</h4><div class="v mono">${q.qA}</div></div><div class="qc-vs">vs</div><div class="qc-col"><h4>Qty B</h4><div class="v mono">${q.qB}</div></div></div>`;
  if(q.type==='mc'||q.type==='qc')body+=`<div class="q-opts" id="curOpts">${q.options.map((o,i)=>`<div class="q-opt" onclick="selOpt(${i})" id="o-${i}"><span class="lt">${String.fromCharCode(65+i)}</span><span>${o}</span></div>`).join('')}</div>`;
  else if(q.type==='numeric')body+=`<input type="text" class="q-num mono" id="numIn" placeholder="?" autocomplete="off" inputmode="decimal">`;
  document.getElementById('prArea').innerHTML=`<div class="q-card"><div class="q-tags"><span class="q-tag" style="background:${bg};color:${fg}">${lb}</span><span class="q-tag" style="background:var(--ac3D);color:var(--ac3)">${q.diff}</span><span class="q-tag" style="background:var(--surface2);color:var(--text2)">${tl[q.type]||'MC'}</span>${q.concept?`<span class="q-tag" style="background:var(--ac5D);color:var(--ac5)">${q.concept}</span>`:''}</div><div class="q-text">${q.text}</div>${body}<div class="q-btns"><button class="btn btn-p" id="chkBtn" onclick="chkAns()">Check Answer</button><button class="btn btn-s" onclick="document.getElementById('expl').classList.add('show')">Show Shortcut</button></div><div class="expl" id="expl"><h4>ğŸ’¡ Solution</h4><p>${q.explanation}</p><div class="sc-lbl">âš¡ SHORTCUT:</div><p>${q.shortcut}</p></div></div>`;
  if(q.isChart&&q.chartFn)setTimeout(q.chartFn,80);
}

function selOpt(i){if(prAns)return;prSel=i;document.querySelectorAll('#curOpts .q-opt').forEach((o,j)=>{o.className='q-opt'+(j===i?' sel':'')});}

function chkAns(){
  if(prAns)return;const q=prQ[prIdx];let ok=false;const t=Math.round((Date.now()-prT0)/1000);
  if(q.type==='numeric'){const inp=document.getElementById('numIn');if(!inp)return;const v=parseFloat(inp.value);if(isNaN(v))return;ok=Math.abs(v-q.answer)<.05;}
  else{if(prSel===null)return;let ci=typeof q.answer==='function'?q.answer:q.answer;if(typeof ci==='object'&&ci!==null)ci=0;ok=prSel===ci;
    document.querySelectorAll('#curOpts .q-opt').forEach((o,j)=>{o.onclick=null;if(j===ci)o.className='q-opt ok';else if(j===prSel&&!ok)o.className='q-opt no';else o.className='q-opt';});}
  prAns=true;S.totalAnswered++;S.topics[q.cat].done++;S.times.push(t);if(S.times.length>300)S.times=S.times.slice(-300);
  if(ok){S.totalCorrect++;S.topics[q.cat].correct++;S.streak++;if(S.streak>S.bestStreak)S.bestStreak=S.streak;}else S.streak=0;
  const lh=S.history[S.history.length-1];if(lh&&S.totalAnswered%10!==0){lh.c+=(ok?1:0);lh.t++;}else S.history.push({c:ok?1:0,t:1});
  if(S.history.length>100)S.history=S.history.slice(-100);
  saveAll();document.getElementById('navStreak').textContent='ğŸ”¥ '+S.streak;
  const btn=document.getElementById('chkBtn');btn.textContent=ok?'âœ“ Correct!':'âœ— Incorrect';btn.style.background=ok?'var(--correct)':'var(--wrong)';btn.onclick=null;
  document.getElementById('expl').classList.add('show');
}
function nextQ(){prIdx++;if(prIdx>=prQ.length)loadBatch();else renderQ();window.scrollTo(0,document.getElementById('pg-pr').offsetTop);}
function startMini(){go('pr');prCat='all';prDiff='all';prConcept='all';prQ=[];prIdx=0;const cats=['arithmetic','algebra','geometry','coordinate','data'];for(let i=0;i<20;i++)prQ.push(genQ(pick(cats),pick(DIFFS)));renderQ();}

// â•â•â• INIT â•â•â•
renderDash();
</script>
</body>
</html>
